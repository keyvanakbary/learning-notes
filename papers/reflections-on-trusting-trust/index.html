<!DOCTYPE html> <html lang="en-US"> <head> <meta charset="UTF-8"> <meta http-equiv="X-UA-Compatible" content="IE=Edge"> <link rel="shortcut icon" href="/learning-notes/favicon.ico" type="image/x-icon"> <link rel="stylesheet" href="/learning-notes/assets/css/just-the-docs-default.css"> <script type="text/javascript" src="/learning-notes/assets/js/vendor/lunr.min.js"></script> <script type="text/javascript" src="/learning-notes/assets/js/just-the-docs.js"></script> <meta name="viewport" content="width=device-width, initial-scale=1"> <!-- Begin Jekyll SEO tag v2.7.1 --> <title>Reflections on Trusting Trust | Notes</title> <meta name="generator" content="Jekyll v3.9.0" /> <meta property="og:title" content="Reflections on Trusting Trust" /> <meta property="og:locale" content="en_US" /> <meta name="description" content="Keyvan Akbary learning notes" /> <meta property="og:description" content="Keyvan Akbary learning notes" /> <meta property="og:site_name" content="Notes" /> <meta name="twitter:card" content="summary" /> <meta property="twitter:title" content="Reflections on Trusting Trust" /> <script type="application/ld+json"> {"headline":"Reflections on Trusting Trust","description":"Keyvan Akbary learning notes","@type":"WebPage","url":"/learning-notes/papers/reflections-on-trusting-trust/","@context":"https://schema.org"}</script> <!-- End Jekyll SEO tag --> </head> <body> <svg xmlns="http://www.w3.org/2000/svg" style="display: none;"> <symbol id="svg-link" viewBox="0 0 24 24"> <title>Link</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"> <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-search" viewBox="0 0 24 24"> <title>Search</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"> <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </symbol> <symbol id="svg-menu" viewBox="0 0 24 24"> <title>Menu</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"> <line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewBox="0 0 24 24"> <title>Expand</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"> <polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <symbol id="svg-doc" viewBox="0 0 24 24"> <title>Document</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"> <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> </svg> <div class="side-bar"> <div class="site-header"> <a href="/learning-notes/" class="site-title lh-tight"> Notes </a> <a href="#" id="menu-button" class="site-button"> <svg viewBox="0 0 24 24" class="icon"><use xlink:href="#svg-menu"></use></svg> </a> </div> <nav role="navigation" aria-label="Main" id="site-nav" class="site-nav"> <ul class="nav-list"><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/learning-notes/articles/" class="nav-list-link">Articles</a><ul class="nav-list "></ul></li><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/learning-notes/books/" class="nav-list-link">Books</a><ul class="nav-list "></ul></li><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/learning-notes/talks/" class="nav-list-link">Talks</a><ul class="nav-list "></ul></li><li class="nav-list-item active"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/learning-notes/papers/" class="nav-list-link">Papers</a><ul class="nav-list "></ul></li></ul> </nav> <footer class="site-footer"> This site uses <a href="https://github.com/pmarsceill/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll. </footer> </div> <div class="main" id="top"> <div id="main-header" class="main-header"> <div class="search"> <div class="search-input-wrap"> <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search Notes" aria-label="Search Notes" autocomplete="off"> <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label> </div> <div id="search-results" class="search-results"></div> </div> <nav aria-label="Auxiliary" class="aux-nav"> <ul class="aux-nav-list"> <li class="aux-nav-list-item"> <a href="//github.com/keyvanakbary/learning-notes" class="site-button" > Learning Notes on GitHub </a> </li> </ul> </nav> </div> <div id="main-content-wrap" class="main-content-wrap"> <nav aria-label="Breadcrumb" class="breadcrumb-nav"> <ol class="breadcrumb-nav-list"> <li class="breadcrumb-nav-list-item"><a href="/learning-notes/papers/">Papers</a></li> <li class="breadcrumb-nav-list-item"><span>Reflections on Trusting Trust</span></li> </ol> </nav> <div id="main-content" class="main-content" role="main"> <h1 id="reflections-on-trusting-trust"> <a href="#reflections-on-trusting-trust" class="anchor-heading" aria-labelledby="reflections-on-trusting-trust"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <a href="https://www.archive.ece.cmu.edu/~ganger/712.fall02/papers/p761-thompson.pdf">Reflections on Trusting Trust</a> </h1> <p>To what extent should one trust a statement of a program is free of Trojan horses? Perhaps it is more important to trust the people who wrote the software.</p> <h2 id="stage-i"> <a href="#stage-i" class="anchor-heading" aria-labelledby="stage-i"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Stage I </h2> <p>The problem is to write the shortest source program that, when compiled and executed, will produce as output an exact copy of its source.</p> <p>It has to have two important properties:</p> <ol> <li>This program can be easily written by another program</li> <li>This program can contain an arbitrary amount of excess baggage that will be reproduced along with the main algorithm</li> </ol> <div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">char</span> <span class="n">s</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="sc">'\t'</span><span class="p">,</span>
	<span class="sc">'0'</span><span class="p">,</span>
	<span class="sc">'\n'</span><span class="p">,</span>
	<span class="sc">'}'</span><span class="p">,</span>
	<span class="sc">';'</span><span class="p">,</span>
	<span class="sc">'\n'</span><span class="p">,</span>
	<span class="sc">'\n'</span><span class="p">,</span>
	<span class="sc">'/'</span><span class="p">,</span>
	<span class="sc">'*'</span><span class="p">,</span>
	<span class="sc">'\n'</span><span class="p">,</span>
	<span class="p">(</span><span class="mi">213</span> <span class="n">lines</span> <span class="n">deleted</span><span class="p">)</span>
	<span class="mi">0</span>
<span class="p">}</span>

<span class="cm">/*
 * The string s is a
 * representation of the body
 * of this program from '0'
 * to the end.
 */</span>

<span class="n">main</span><span class="p">()</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">i</span><span class="p">;</span>
	
	<span class="n">printf</span><span class="p">(</span><span class="s">"char</span><span class="se">\t</span><span class="s">s[] = {</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
	<span class="k">for</span><span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">];</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
		<span class="n">printf</span><span class="p">(</span><span class="s">"</span><span class="se">\t</span><span class="s">%d, </span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
	<span class="n">printf</span><span class="p">(</span><span class="s">"%s"</span><span class="p">,</span> <span class="n">s</span><span class="p">);</span>
<span class="p">}</span> 
</code></pre></div></div> <h2 id="stage-ii"> <a href="#stage-ii" class="anchor-heading" aria-labelledby="stage-ii"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Stage II </h2> <p>The C compiler is written in C. C allows individual characters in the string to be escaped to represent unprintable characters. For example</p> <div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code>	<span class="s">"Hello world</span><span class="se">\n</span><span class="s">"</span>
</code></pre></div></div> <p>It “knows” in a completely portable way what character code is compiled for a new line in a character set.</p> <div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">c</span> <span class="o">=</span> <span class="n">next</span><span class="p">();</span>
<span class="k">if</span><span class="p">(</span><span class="n">c</span> <span class="o">!=</span> <span class="sc">'\\'</span><span class="p">)</span>
	<span class="k">return</span><span class="p">(</span><span class="n">c</span><span class="p">);</span>
<span class="n">c</span> <span class="o">=</span> <span class="n">next</span><span class="p">();</span>
<span class="k">if</span><span class="p">(</span><span class="n">c</span> <span class="o">==</span> <span class="sc">'\\'</span><span class="p">)</span>
	<span class="k">return</span><span class="p">(</span><span class="sc">'\\'</span><span class="p">);</span>
<span class="k">if</span><span class="p">(</span><span class="n">c</span> <span class="o">==</span> <span class="sc">'n'</span><span class="p">)</span>
	<span class="k">return</span><span class="p">(</span><span class="sc">'\n'</span><span class="p">);</span>
</code></pre></div></div> <p>Suppose we wish to alter the C compiler to include <code class="language-plaintext highlighter-rouge">'\v'</code> to represent the vertical tab character. We must “train” the compiler. After it “knows” what <code class="language-plaintext highlighter-rouge">'\v'</code> means, then our new change will become legal C.</p> <div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">c</span> <span class="o">=</span> <span class="n">next</span><span class="p">();</span>
<span class="k">if</span><span class="p">(</span><span class="n">c</span> <span class="o">!=</span> <span class="sc">'\\'</span><span class="p">)</span>
	<span class="k">return</span><span class="p">(</span><span class="n">c</span><span class="p">);</span>
<span class="n">c</span> <span class="o">=</span> <span class="n">next</span><span class="p">();</span>
<span class="k">if</span><span class="p">(</span><span class="n">c</span> <span class="o">==</span> <span class="sc">'\\'</span><span class="p">)</span>
	<span class="k">return</span><span class="p">(</span><span class="sc">'\\'</span><span class="p">);</span>
<span class="k">if</span><span class="p">(</span><span class="n">c</span> <span class="o">==</span> <span class="sc">'n'</span><span class="p">)</span>
	<span class="k">return</span><span class="p">(</span><span class="sc">'\n'</span><span class="p">);</span>
<span class="k">if</span><span class="p">(</span><span class="n">c</span> <span class="o">==</span> <span class="sc">'v'</span><span class="p">)</span>
	<span class="k">return</span><span class="p">(</span><span class="sc">'\v'</span><span class="p">);</span>
</code></pre></div></div> <p>Now, the old compiler won’t accept the new source. We look up on an ASCII chart that a vertical tab is decimal 11, we can alter our source code so the old compiler accepts the new source.</p> <div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">c</span> <span class="o">=</span> <span class="n">next</span><span class="p">();</span>
<span class="k">if</span><span class="p">(</span><span class="n">c</span> <span class="o">!=</span> <span class="sc">'\\'</span><span class="p">)</span>
	<span class="k">return</span><span class="p">(</span><span class="n">c</span><span class="p">);</span>
<span class="n">c</span> <span class="o">=</span> <span class="n">next</span><span class="p">();</span>
<span class="k">if</span><span class="p">(</span><span class="n">c</span> <span class="o">==</span> <span class="sc">'\\'</span><span class="p">)</span>
	<span class="k">return</span><span class="p">(</span><span class="sc">'\\'</span><span class="p">);</span>
<span class="k">if</span><span class="p">(</span><span class="n">c</span> <span class="o">==</span> <span class="sc">'n'</span><span class="p">)</span>
	<span class="k">return</span><span class="p">(</span><span class="sc">'\n'</span><span class="p">);</span>
<span class="k">if</span><span class="p">(</span><span class="n">c</span> <span class="o">==</span> <span class="sc">'v'</span><span class="p">)</span>
	<span class="k">return</span><span class="p">(</span><span class="mi">11</span><span class="p">);</span>
</code></pre></div></div> <p>You simply tell it once, then you can use this self-referencing definition.</p> <h2 id="stage-iii"> <a href="#stage-iii" class="anchor-heading" aria-labelledby="stage-iii"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Stage III </h2> <p>We can do a simple modification to the compiler that will deliberately miscompile source. If this were not deliberate, it would be called compiler “bug”. Since it is deliberate it should be called a “Trojan horse”.</p> <div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">compile</span><span class="p">(</span><span class="n">s</span><span class="p">);</span>
<span class="kt">char</span> <span class="o">*</span><span class="n">s</span><span class="p">;</span>
<span class="p">{</span>
	<span class="k">if</span><span class="p">(</span><span class="n">match</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="s">"pattern"</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">compile</span><span class="p">(</span><span class="s">"bug"</span><span class="p">);</span>
		<span class="k">return</span><span class="p">;</span>	
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div> <p>First we compile the modified source with the normal C compiler to produce a bugged binary. We install this binary as the official C. We can now remove the bugs from the source of the compiler and the new binary will reinsert the bugs whenever it is compiled. Programs will remain bugged with no trace in source anywhere.</p> <h2 id="moral"> <a href="#moral" class="anchor-heading" aria-labelledby="moral"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Moral </h2> <p>You can’t trust code that yu did not totally create yourself. No amount of source-level verification or scrutiny will protect you from using untrusted code.</p> <p>The act of breaking into a computer system has to have the same social stigma as breaking into a neighbour’s house. It should not matter that the neighbour’s door is unlocked. The press must earn that misguided use of a computer is no more amazing than a drunk driving of an automobile.</p> </div> </div> <div class="search-overlay"></div> </div> </body> </html>
