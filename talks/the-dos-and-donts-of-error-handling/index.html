<!DOCTYPE html> <html lang="en-US"> <head> <meta charset="UTF-8"> <meta http-equiv="X-UA-Compatible" content="IE=Edge"> <link rel="shortcut icon" href="/learning-notes/favicon.ico" type="image/x-icon"> <link rel="stylesheet" href="/learning-notes/assets/css/just-the-docs-default.css"> <script type="text/javascript" src="/learning-notes/assets/js/vendor/lunr.min.js"></script> <script type="text/javascript" src="/learning-notes/assets/js/just-the-docs.js"></script> <meta name="viewport" content="width=device-width, initial-scale=1"> <!-- Begin Jekyll SEO tag v2.7.1 --> <title>The Do’s and Don’ts of Error Handling | Notes</title> <meta name="generator" content="Jekyll v3.9.0" /> <meta property="og:title" content="The Do’s and Don’ts of Error Handling" /> <meta property="og:locale" content="en_US" /> <meta name="description" content="Keyvan Akbary learning notes" /> <meta property="og:description" content="Keyvan Akbary learning notes" /> <meta property="og:site_name" content="Notes" /> <meta name="twitter:card" content="summary" /> <meta property="twitter:title" content="The Do’s and Don’ts of Error Handling" /> <script type="application/ld+json"> {"headline":"The Do’s and Don’ts of Error Handling","description":"Keyvan Akbary learning notes","@type":"WebPage","url":"/learning-notes/talks/the-dos-and-donts-of-error-handling/","@context":"https://schema.org"}</script> <!-- End Jekyll SEO tag --> </head> <body> <svg xmlns="http://www.w3.org/2000/svg" style="display: none;"> <symbol id="svg-link" viewBox="0 0 24 24"> <title>Link</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"> <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-search" viewBox="0 0 24 24"> <title>Search</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"> <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </symbol> <symbol id="svg-menu" viewBox="0 0 24 24"> <title>Menu</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"> <line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewBox="0 0 24 24"> <title>Expand</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"> <polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <symbol id="svg-doc" viewBox="0 0 24 24"> <title>Document</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"> <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> </svg> <div class="side-bar"> <div class="site-header"> <a href="/learning-notes/" class="site-title lh-tight"> Notes </a> <a href="#" id="menu-button" class="site-button"> <svg viewBox="0 0 24 24" class="icon"><use xlink:href="#svg-menu"></use></svg> </a> </div> <nav role="navigation" aria-label="Main" id="site-nav" class="site-nav"> <ul class="nav-list"><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/learning-notes/articles/" class="nav-list-link">Articles</a><ul class="nav-list "></ul></li><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/learning-notes/books/" class="nav-list-link">Books</a><ul class="nav-list "></ul></li><li class="nav-list-item active"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/learning-notes/talks/" class="nav-list-link">Talks</a><ul class="nav-list "></ul></li><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/learning-notes/papers/" class="nav-list-link">Papers</a><ul class="nav-list "></ul></li></ul> </nav> <footer class="site-footer"> This site uses <a href="https://github.com/pmarsceill/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll. </footer> </div> <div class="main" id="top"> <div id="main-header" class="main-header"> <div class="search"> <div class="search-input-wrap"> <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search Notes" aria-label="Search Notes" autocomplete="off"> <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label> </div> <div id="search-results" class="search-results"></div> </div> <nav aria-label="Auxiliary" class="aux-nav"> <ul class="aux-nav-list"> <li class="aux-nav-list-item"> <a href="//github.com/keyvanakbary/learning-notes" class="site-button" > Learning Notes on GitHub </a> </li> </ul> </nav> </div> <div id="main-content-wrap" class="main-content-wrap"> <nav aria-label="Breadcrumb" class="breadcrumb-nav"> <ol class="breadcrumb-nav-list"> <li class="breadcrumb-nav-list-item"><a href="/learning-notes/talks/">Talks</a></li> <li class="breadcrumb-nav-list-item"><span>The Do’s and Don’ts of Error Handling</span></li> </ol> </nav> <div id="main-content" class="main-content" role="main"> <h1 id="the-dos-and-donts-of-error-handling"> <a href="#the-dos-and-donts-of-error-handling" class="anchor-heading" aria-labelledby="the-dos-and-donts-of-error-handling"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <a href="https://www.youtube.com/watch?v=TTM_b7EJg5E">The Do’s and Don’ts of Error Handling</a> </h1> <blockquote> <p>A system is fault-tolerant if it continues working even if something is wrong</p> </blockquote> <blockquote> <p>Work like this is never finished, it’s always in-progress</p> </blockquote> <ul> <li>Hardware can fail (relatively uncommon)</li> <li>Software can fail (common)</li> </ul> <h2 id="overview"> <a href="#overview" class="anchor-heading" aria-labelledby="overview"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Overview </h2> <ul> <li>Fault-tolerance cannot be achieved using a single computer – it may fail</li> <li>We have to use several computers <ul> <li>Concurrency</li> <li>Parallel programming</li> <li>Distributed programming</li> <li>Physics – time to propagate messages</li> <li>Engineering</li> <li><strong>Message passing is inevitable</strong> – the basis of Object-Oriented Programming</li> </ul> </li> <li>Programming languages should make this ~easy~ doable</li> </ul> <p>We are never going to eliminate failure, systems will be inconsistent. We have to deal with it.</p> <ul> <li>How individual computers work is the smaller problem. How the system works as a whole is important.</li> <li>How the computers are interconnected and the protocols used between computers is the significant problem.</li> <li>We want the same way to program large and small scale systems.</li> </ul> <p>Why do we have to program differently for local programs to communicate (memory) versus distributed systems (message bus)?</p> <p>In Object-Oriented Programming, Alan Kay said that the big idea behind Object-Oriented Programming was “messaging”</p> <h2 id="erlang"> <a href="#erlang" class="anchor-heading" aria-labelledby="erlang"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Erlang </h2> <ul> <li>Derived from Smalltalk and Prolog (influenced by ideas from CSP)</li> <li>Unifies ideas on concurrent and functional programming</li> <li>Follows laws of physics (asynchronous messaging)</li> <li>Designed for programming fault-tolerant systems</li> </ul> <p>Invented Erlang to solve a problem, not the language to find a problem to be solved with it.</p> <p>Building fault-tolerant software boils down to detecting errors and doing something when errors are detected.</p> <blockquote> <p>We can’t fix our own errors in the same way if I’m having a heart attack, I’ll need someone to help me out</p> </blockquote> <h2 id="types-of-errors"> <a href="#types-of-errors" class="anchor-heading" aria-labelledby="types-of-errors"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Types of errors </h2> <ul> <li>Errors that can be detected at compile time</li> <li>Errors that can be detected at run-time</li> <li>Errors that can be inferred</li> <li>Reproducible errors</li> <li>Non-reproducible errors</li> </ul> <h2 id="philosophy"> <a href="#philosophy" class="anchor-heading" aria-labelledby="philosophy"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Philosophy </h2> <ul> <li>Find methods to prove Software correct at compile-time</li> <li>Assume software is incorrect and will fail at run-time then do something about it at run-time</li> </ul> <h2 id="evidence-for-software-failure-is-all-around-us"> <a href="#evidence-for-software-failure-is-all-around-us" class="anchor-heading" aria-labelledby="evidence-for-software-failure-is-all-around-us"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Evidence for software failure is all around us </h2> <p>Proving the self-consistency of small programs will not help. Testing a system will tell us that is self-consistent, not that it is correct.</p> <h2 id="conclusion"> <a href="#conclusion" class="anchor-heading" aria-labelledby="conclusion"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Conclusion </h2> <ul> <li>Some small things can be proven to be self-consistent.</li> <li>Large assemblies of small things are possible to prove correct.</li> </ul><hr /> <p>1980 - Erlang model of computation rejected. Shared memory systems ruled the world. 1985 - Ericsson started working on “a replacement of PLEX”, started thinking about errors. “errors must be corrected somewhere else”, “shared memory is evil”, “pure message passing” 1986 - Erlang, unification of OO with FP 1998 - Several products in Erlang, Erlang gets banned and moved to Open Source 2004 - Erlang model of computation widely adopted in many different languages.</p> <h2 id="types-of-system"> <a href="#types-of-system" class="anchor-heading" aria-labelledby="types-of-system"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Types of system </h2> <ul> <li>Highly reliable (nuclear power plant control, air-traffic), satellite (very expensive if they fail)</li> <li>Reliable (driverless cars) (moderately expensive if they fail. Kills people if they fail)</li> <li>Reliable (annoys people if they fail), banks, telephone</li> <li>Dodgy (cross if they fail), Internet, HBO, Netflix</li> <li>Crap (very cross if they fail), free apps</li> </ul> <p>Different technologies are used to build and validate the systems.</p> <p>How can we make software that works reasonably well even if there are errors in the software? “Making reliable distributed systems in the presence of software errors” book by Joe Armstrong</p> <h2 id="requirements"> <a href="#requirements" class="anchor-heading" aria-labelledby="requirements"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Requirements </h2> <ul> <li>Concurrency</li> <li>Error encapsulation</li> <li>Fault detection</li> <li>Fault identification</li> <li>Code upgrade</li> <li>Stable storage</li> </ul> <h2 id="the-method"> <a href="#the-method" class="anchor-heading" aria-labelledby="the-method"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> The “method” </h2> <ul> <li>Detect all errors</li> <li>If you can’t do what you want to do try to do something simpler (relax requirements)</li> <li>Handle errors “remotely” (detect errors and ensure that the system is put into a safe state defined by an invariant)</li> <li>Identify the “Error Kernel” (the part that must be correct)</li> </ul> <h2 id="supervision-trees"> <a href="#supervision-trees" class="anchor-heading" aria-labelledby="supervision-trees"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Supervision trees </h2> <p>The node can be on different machine. Akka is “Erlang supervision for Java and Scala”</p> <h2 id="it-works"> <a href="#it-works" class="anchor-heading" aria-labelledby="it-works"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> It works </h2> <ul> <li>Ericsson smart phone data setup</li> <li>WhatsApp</li> <li>CouchDB (CERN)</li> <li>Cisco (netconf)</li> <li>Spine2 (NHS - uk - riak (basho) replaces Oracle)</li> <li>RabbitMQ</li> </ul><hr /> <h2 id="what-is-an-error"> <a href="#what-is-an-error" class="anchor-heading" aria-labelledby="what-is-an-error"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> What is an error? </h2> <ul> <li>An undesirable property of a program</li> <li>Something that crashes a program</li> <li>A deviation between desired and observed behaviour</li> </ul> <h2 id="who-finds-the-error"> <a href="#who-finds-the-error" class="anchor-heading" aria-labelledby="who-finds-the-error"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Who finds the error? </h2> <ul> <li>The program (run-time) finds the error <ul> <li>Errors <ul> <li>Arithmetic errors: divide by zero, overflow, underflow, …</li> <li>Array bounds violated</li> <li>System routine called with nonsense arguments</li> <li>Null pointer</li> <li>Switch option not provisioned</li> <li>An incorrect value is observed</li> </ul> </li> <li>What can we do <ul> <li>Ignore it (no)</li> <li>Try to fix it (no)</li> <li>Crash immediately (yes) <ul> <li>Don’t make matters worse</li> <li>Assume somebody else will fix the problem (someone up in the supervision tree, this is like rebooting the system)</li> </ul> </li> </ul> </li> <li>What should the programmer do when they don’t know what to do? <ul> <li>Ignore it (no)</li> <li>Log it (yes)</li> <li>Try to fix it (possibly, but don’t make maters worse)</li> <li>Crash immediately (yes)</li> </ul> </li> <li>In sequential languages with single threads, crashing is not widely</li> </ul> </li> <li>The programmer finds the error</li> <li>The compiler finds the error</li> </ul> <h2 id="whats-the-big-deal-about-concurrency"> <a href="#whats-the-big-deal-about-concurrency" class="anchor-heading" aria-labelledby="whats-the-big-deal-about-concurrency"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> What’s the big deal about concurrency? </h2> <p>A sequential program when crashes it turns everything down (single thread).</p> <p>When in a parallel program something crashes, the rest should keep working. There are linked process, if a process dies, these other processes are going to tell the process has died; these processes are going to get error messages.</p> <h2 id="why-concurrency"> <a href="#why-concurrency" class="anchor-heading" aria-labelledby="why-concurrency"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Why concurrency? </h2> <ul> <li>Fault-tolerance is impossible with one computer</li> <li>Scalable is impossible with one computer (yes, you can scale things vertically up to a limit; up to the capacity of the computer)</li> <li>Security is very difficult with one computer (if the system gets compromised, everything gets compromised)</li> <li>I want one way to program not two ways. One for local systems, the other for distributed systems (rules out shared memory)</li> <li>The world is concurrent</li> </ul> <h2 id="detecting-errors"> <a href="#detecting-errors" class="anchor-heading" aria-labelledby="detecting-errors"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Detecting errors </h2> <h3 id="where-do-errors-come-from"> <a href="#where-do-errors-come-from" class="anchor-heading" aria-labelledby="where-do-errors-come-from"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Where do errors come from </h3> <ul> <li>Arithmetic errors <ul> <li>Silent <strong>and deadly</strong> errors, errors where the program does not crash but delivers an incorrect result</li> <li>Noisy errors, errors which cause the program to crash</li> <li>Very difficult to get right <ul> <li>The same answer in a single and double precision does not mean the answer is right</li> <li>If it matters, you must prove every line containing arithmetic is correct</li> <li>Real arithmetic is not associative</li> </ul> </li> </ul> </li> <li>Unexpected inputs</li> <li>Wrong values <ul> <li>Programs does not crash, but the values computed are incorrect or inaccurate</li> <li>How do we know if a program/value is incorrect if we do not have a specification</li> <li>Many programs have no specifications or specs that are so imprecise to be useless</li> <li>The specification might be incorrect <em>and the tests and the program</em></li> </ul> </li> <li>Wrong assumptions about the environment</li> <li>Sequencing errors</li> <li>Concurrency errors</li> <li>Breaking laws of maths or physics</li> </ul><hr /> <p>The programmer does not know what to do: CRASH</p> <blockquote> <p>I call this “let it crash” Somebody else will fix the error Needs concurrency and links</p> </blockquote> <p>What do you do when you receive an error?</p> <ul> <li>Maintain an invariant</li> <li>Try to do something simpler</li> </ul> <h2 id="is-that-all"> <a href="#is-that-all" class="anchor-heading" aria-labelledby="is-that-all"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Is that all? </h2> <p>What’s a message?</p> <ul> <li>A program is a black box</li> <li>There are thousands of programming languages</li> <li>What language used is irrelevant</li> <li>The only important thing is what happens at the interface, their behaviour</li> <li>Two systems are the same if they obey observational equivalence</li> </ul> <p>We shouldn’t care about what happen inside these boxes, we just take care about the boundaries.</p> <ul> <li>Interaction between components involves message passing</li> <li>There are very few ways to describe messages (JSON, XML)</li> <li>There are very very few formal ways to describe the valid sequences of messages (= protocols) between components <ul> <li>We need a way to describe protocols. Protocols are contracts. Contracts assign blame. We need an architecture that describes what we see on the wire: the contract checker <ul> <li>How do we describe contracts?</li> </ul> </li> </ul> </li> </ul> </div> </div> <div class="search-overlay"></div> </div> </body> </html>
