<!DOCTYPE html> <html lang="en-US"> <head> <meta charset="UTF-8"> <meta http-equiv="X-UA-Compatible" content="IE=Edge"> <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon"> <link rel="stylesheet" href="/assets/css/just-the-docs-default.css"> <script type="text/javascript" src="/assets/js/vendor/lunr.min.js"></script> <script type="text/javascript" src="/assets/js/just-the-docs.js"></script> <meta name="viewport" content="width=device-width, initial-scale=1"> <!-- Begin Jekyll SEO tag v2.7.1 --> <title>Grinding the monolith | Notes</title> <meta name="generator" content="Jekyll v3.9.0" /> <meta property="og:title" content="Grinding the monolith" /> <meta property="og:locale" content="en_US" /> <meta name="description" content="Keyvan Akbary learning notes" /> <meta property="og:description" content="Keyvan Akbary learning notes" /> <meta property="og:site_name" content="Notes" /> <meta name="twitter:card" content="summary" /> <meta property="twitter:title" content="Grinding the monolith" /> <script type="application/ld+json"> {"headline":"Grinding the monolith","description":"Keyvan Akbary learning notes","@type":"WebPage","url":"/talks/grinding-the-monolith/","@context":"https://schema.org"}</script> <!-- End Jekyll SEO tag --> </head> <body> <svg xmlns="http://www.w3.org/2000/svg" style="display: none;"> <symbol id="svg-link" viewBox="0 0 24 24"> <title>Link</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"> <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-search" viewBox="0 0 24 24"> <title>Search</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"> <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </symbol> <symbol id="svg-menu" viewBox="0 0 24 24"> <title>Menu</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"> <line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewBox="0 0 24 24"> <title>Expand</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"> <polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <symbol id="svg-doc" viewBox="0 0 24 24"> <title>Document</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"> <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> </svg> <div class="side-bar"> <div class="site-header"> <a href="/" class="site-title lh-tight"> Notes </a> <a href="#" id="menu-button" class="site-button"> <svg viewBox="0 0 24 24" class="icon"><use xlink:href="#svg-menu"></use></svg> </a> </div> <nav role="navigation" aria-label="Main" id="site-nav" class="site-nav"> <ul class="nav-list"><li class="nav-list-item"><a href="/" class="nav-list-link">Home</a></li><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/articles/" class="nav-list-link">Articles</a><ul class="nav-list "></ul></li><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/books/" class="nav-list-link">Books</a><ul class="nav-list "></ul></li><li class="nav-list-item active"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/talks/" class="nav-list-link">Talks</a><ul class="nav-list "></ul></li><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/papers/" class="nav-list-link">Papers</a><ul class="nav-list "></ul></li></ul> </nav> <footer class="site-footer"> This site uses <a href="https://github.com/pmarsceill/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll. </footer> </div> <div class="main" id="top"> <div id="main-header" class="main-header"> <div class="search"> <div class="search-input-wrap"> <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search Notes" aria-label="Search Notes" autocomplete="off"> <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label> </div> <div id="search-results" class="search-results"></div> </div> <nav aria-label="Auxiliary" class="aux-nav"> <ul class="aux-nav-list"> <li class="aux-nav-list-item"> <a href="//github.com/keyvanakbary/learning-notes" class="site-button" > Learning Notes on GitHub </a> </li> </ul> </nav> </div> <div id="main-content-wrap" class="main-content-wrap"> <nav aria-label="Breadcrumb" class="breadcrumb-nav"> <ol class="breadcrumb-nav-list"> <li class="breadcrumb-nav-list-item"><a href="/talks/">Talks</a></li> <li class="breadcrumb-nav-list-item"><span>Grinding the monolith</span></li> </ol> </nav> <div id="main-content" class="main-content" role="main"> <h1 id="grinding-the-monolith"> <a href="#grinding-the-monolith" class="anchor-heading" aria-labelledby="grinding-the-monolith"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <a href="https://www.youtube.com/watch?v=xxW_c_8AHiE">Grinding the monolith</a> </h1> <h2 id="monolith"> <a href="#monolith" class="anchor-heading" aria-labelledby="monolith"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Monolith </h2> <p>Pros:</p> <ul> <li>Easier to deploy</li> <li>Easier to place and find stuff in</li> </ul> <h2 id="microservices"> <a href="#microservices" class="anchor-heading" aria-labelledby="microservices"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Microservices </h2> <p>Cons:</p> <ul> <li>Operational complexity</li> <li>Partial failure</li> </ul> <p>Pros:</p> <ul> <li>Independence of development</li> <li>Independence of scalability</li> <li>Building in smaller and simpler pieces</li> </ul> <h3 id="we-have-heard-the-story-before"> <a href="#we-have-heard-the-story-before" class="anchor-heading" aria-labelledby="we-have-heard-the-story-before"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> We have heard the story before </h3> <p>Java Beans, COMM, COBRA</p> <ul> <li>Independent components, you can just buy and connectcomponents</li> <li>Decoupled and simple pieces</li> </ul> <p>We can have software that works like Lego. But this hypothesis does not work in reality as there are many more dimensions (connections between components). Components may have hundreds or thousands of collaborators, we would need to have to have nth dimensional Lego bricks!</p> <p>Maybe a better model would be Mycelium, a fungus where fractal roots communicate to each other in a way more complex way.</p> <p>We can try to make a clear horizontal layered separation: UI, Application, Domain, Persistence. Try to repeat the pattern in vertical separations, but soon enough they will start coupling each other. We can make the thing even worse with operational monitoring, logging, etc.</p> <p>Maybe the Layers architecture referred more to protocol stacks than to web applications, precisely because of the standarisation of interfaces between layers does not generally apply.</p> <h2 id="microservices-1"> <a href="#microservices-1" class="anchor-heading" aria-labelledby="microservices-1"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Microservices </h2> <p>The key issue is around <strong>safety</strong> for different teams to operate independently. Issues from other teams should affect yours. Without this, you’ll start adding checks, reviews, etc. “The Fear Cycle”.</p> <p>Safety failure in Monoliths</p> <ul> <li>Bad code has an unlimited span of effect (SQL leak will affect all code)</li> <li>Modifying shared code will affect other teams</li> <li>Semantic coupling, different concepts mixed under the same name. What works for one context, may not work for the other</li> </ul> <p>All those make code changes slow. Many teams tried transformations towards microservices, 2/3s failed because impatience, unrealistic expectations, or hubris.</p> <h2 id="strategies-to-move-towards-microservices"> <a href="#strategies-to-move-towards-microservices" class="anchor-heading" aria-labelledby="strategies-to-move-towards-microservices"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Strategies to move towards microservices </h2> <h3 id="clean-then-separate"> <a href="#clean-then-separate" class="anchor-heading" aria-labelledby="clean-then-separate"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Clean then separate </h3> <p>Refactor to create interfaces between subdomains, then turn those into HTTP interfaces.</p> <p><strong>Failed</strong></p> <ul> <li>You have to stop feature development</li> <li>You have the clean team is going slower than the feature teams that will make compromises to go faster (their work is throwaway)</li> </ul> <h3 id="entity-services"> <a href="#entity-services" class="anchor-heading" aria-labelledby="entity-services"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Entity services </h3> <p>You turn your key domain objects into services</p> <p><strong>Failed</strong></p> <ul> <li>Transactionality problems. Microservices need to have behaviour</li> <li>Deployments are painful as redeploying a core entity service will affect a lot of clients</li> <li>Distributed monolith</li> </ul> <h3 id="project-teams"> <a href="#project-teams" class="anchor-heading" aria-labelledby="project-teams"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Project teams </h3> <p>Have a pool of people (contractors) do create services and throw them back to the pool once they finish.</p> <p><strong>Failed</strong></p> <ul> <li>Favour deadlines (short term) over high quality code and architecture initiatives (long term)</li> <li>If you done your hard work, you should enjoy the fruit of the result. If not, you should leave with it and learn from it</li> <li>Better to have product teams (which can have projects)</li> </ul> <h3 id="clean-sheet-design-of-a-new-services"> <a href="#clean-sheet-design-of-a-new-services" class="anchor-heading" aria-labelledby="clean-sheet-design-of-a-new-services"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Clean-sheet design of a new services </h3> <p>Create new services from scratch</p> <p><strong>Failed</strong></p> <ul> <li>We make the same mistakes over and over</li> <li>This system will always lag behind</li> <li>Optimism not supported by past evidence. What happened last time (unexpected issues) is most likely to happen this time</li> </ul> <h3 id="the-strangler"> <a href="#the-strangler" class="anchor-heading" aria-labelledby="the-strangler"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> The strangler </h3> <p>Intercept traffic to the existing system and replace pieces with new services. It is a transitional pattern.</p> <p><strong>Partial success</strong></p> <h3 id="clone-and-slash"> <a href="#clone-and-slash" class="anchor-heading" aria-labelledby="clone-and-slash"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Clone and slash </h3> <p>Clone the monolith for each team. Remove the code the team does not need. Transitional state. You will be sharing the DB for a long time.</p> <p><strong>Success</strong></p> <h3 id="continual-redesignrebuild"> <a href="#continual-redesignrebuild" class="anchor-heading" aria-labelledby="continual-redesignrebuild"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Continual redesign/rebuild </h3> <p>Keep the presure on to keep redesigning, microservices are never done. Remove code and microservices, which is one of the main benefits of removing microservices.</p> <p><strong>Success</strong></p> <h3 id="microservices-by-lifecycle"> <a href="#microservices-by-lifecycle" class="anchor-heading" aria-labelledby="microservices-by-lifecycle"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Microservices by lifecycle </h3> <p>Each stage of the process has its own microservice, and each process/microservice passes the state to the next.</p> <p><strong>Success</strong></p> <h3 id="transmit-domain-objects-on-the-wire"> <a href="#transmit-domain-objects-on-the-wire" class="anchor-heading" aria-labelledby="transmit-domain-objects-on-the-wire"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Transmit domain objects on the wire </h3> <p>Domain objects as the representation to transfer in APIs.</p> <p><strong>Failure</strong></p> <ul> <li>Domain object coupled with the API, will be very difficult to evolve and change</li> <li>Makes it very difficult to handle multiple versions of APIs</li> <li>Leaks implementation details and internals of the service</li> </ul> <p>Turn domain objects into hashmaps, lists, etc.</p> <h3 id="refactor-to-hexagons"> <a href="#refactor-to-hexagons" class="anchor-heading" aria-labelledby="refactor-to-hexagons"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Refactor to hexagons </h3> <p>Express the domain independently from integration and persistence implementation details.</p> <p><strong>Success</strong></p><hr /> <p>Think long-term, act short-term. Solve the problem in front of you.</p><hr /> <p>References</p> <ul> <li>“Layers architecture”: <a href="https://www.goodreads.com/book/show/85039.Pattern_Oriented_Software_Architecture_Volume_1">Pattern oriented software architecture, vol 1</a></li> </ul> </div> </div> <div class="search-overlay"></div> </div> </body> </html>
