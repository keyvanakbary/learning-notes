<!DOCTYPE html> <html lang="en-US"> <head> <meta charset="UTF-8"> <meta http-equiv="X-UA-Compatible" content="IE=Edge"> <link rel="shortcut icon" href="/learning-notes/favicon.ico" type="image/x-icon"> <link rel="stylesheet" href="/learning-notes/assets/css/just-the-docs-default.css"> <script type="text/javascript" src="/learning-notes/assets/js/vendor/lunr.min.js"></script> <script type="text/javascript" src="/learning-notes/assets/js/just-the-docs.js"></script> <meta name="viewport" content="width=device-width, initial-scale=1"> <!-- Begin Jekyll SEO tag v2.7.1 --> <title>TDD, where did it all go wrong | Notes</title> <meta name="generator" content="Jekyll v3.9.0" /> <meta property="og:title" content="TDD, where did it all go wrong" /> <meta property="og:locale" content="en_US" /> <meta name="description" content="Keyvan Akbary learning notes" /> <meta property="og:description" content="Keyvan Akbary learning notes" /> <meta property="og:site_name" content="Notes" /> <meta name="twitter:card" content="summary" /> <meta property="twitter:title" content="TDD, where did it all go wrong" /> <script type="application/ld+json"> {"headline":"TDD, where did it all go wrong","description":"Keyvan Akbary learning notes","@type":"WebPage","url":"/learning-notes/talks/tdd-where-did-it-all-go-wrong/","@context":"https://schema.org"}</script> <!-- End Jekyll SEO tag --> </head> <body> <svg xmlns="http://www.w3.org/2000/svg" style="display: none;"> <symbol id="svg-link" viewBox="0 0 24 24"> <title>Link</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"> <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-search" viewBox="0 0 24 24"> <title>Search</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"> <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </symbol> <symbol id="svg-menu" viewBox="0 0 24 24"> <title>Menu</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"> <line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewBox="0 0 24 24"> <title>Expand</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"> <polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <symbol id="svg-doc" viewBox="0 0 24 24"> <title>Document</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"> <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> </svg> <div class="side-bar"> <div class="site-header"> <a href="/learning-notes/" class="site-title lh-tight"> Notes </a> <a href="#" id="menu-button" class="site-button"> <svg viewBox="0 0 24 24" class="icon"><use xlink:href="#svg-menu"></use></svg> </a> </div> <nav role="navigation" aria-label="Main" id="site-nav" class="site-nav"> <ul class="nav-list"><li class="nav-list-item"><a href="/learning-notes/" class="nav-list-link">Home</a></li><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/learning-notes/articles/" class="nav-list-link">Articles</a><ul class="nav-list "></ul></li><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/learning-notes/books/" class="nav-list-link">Books</a><ul class="nav-list "></ul></li><li class="nav-list-item active"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/learning-notes/talks/" class="nav-list-link">Talks</a><ul class="nav-list "></ul></li><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/learning-notes/papers/" class="nav-list-link">Papers</a><ul class="nav-list "></ul></li></ul> </nav> <footer class="site-footer"> This site uses <a href="https://github.com/pmarsceill/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll. </footer> </div> <div class="main" id="top"> <div id="main-header" class="main-header"> <div class="search"> <div class="search-input-wrap"> <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search Notes" aria-label="Search Notes" autocomplete="off"> <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label> </div> <div id="search-results" class="search-results"></div> </div> <nav aria-label="Auxiliary" class="aux-nav"> <ul class="aux-nav-list"> <li class="aux-nav-list-item"> <a href="//github.com/keyvanakbary/learning-notes" class="site-button" > Learning Notes on GitHub </a> </li> </ul> </nav> </div> <div id="main-content-wrap" class="main-content-wrap"> <nav aria-label="Breadcrumb" class="breadcrumb-nav"> <ol class="breadcrumb-nav-list"> <li class="breadcrumb-nav-list-item"><a href="/learning-notes/talks/">Talks</a></li> <li class="breadcrumb-nav-list-item"><span>TDD, where did it all go wrong</span></li> </ol> </nav> <div id="main-content" class="main-content" role="main"> <h1 id="tdd-where-did-it-all-go-wrong"> <a href="#tdd-where-did-it-all-go-wrong" class="anchor-heading" aria-labelledby="tdd-where-did-it-all-go-wrong"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <a href="https://vimeo.com/68375232">TDD, where did it all go wrong</a> </h1> <h3 id="frustrations-with-tdd"> <a href="#frustrations-with-tdd" class="anchor-heading" aria-labelledby="frustrations-with-tdd"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Frustrations with TDD </h3> <p>Didn’t refactoring promise change without breaking tests?</p> <p>If we change the implementation details, non of our tests should break.</p> <p>More test code than implementation code.</p> <p>Programming Anarchy and Lean Software Development drop tests first.</p> <p>Duct tape programmer, delivers functionality faster, quickly abandoning tests as “slowing them down’</p> <p>Difficult to understand test intent, why tests fail.</p> <p>ATDD suites:</p> <ul> <li>much of their life in red</li> <li>Customers don’t engange with the suite</li> <li>slow to run and increasing cost. <ul> <li>devs ignoring red results</li> <li>we need tools to fix them</li> <li>devs don’t want to write them</li> </ul> </li> </ul> <h2 id="where-did-it-all-go-wrong"> <a href="#where-did-it-all-go-wrong" class="anchor-heading" aria-labelledby="where-did-it-all-go-wrong"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Where did it all go wrong? </h2> <ul> <li>Writing tests against operations instead of writing them against behaviour (BDD).</li> <li>Coupling our tests to implementation details.</li> </ul> <h3 id="tdd-rebooted"> <a href="#tdd-rebooted" class="anchor-heading" aria-labelledby="tdd-rebooted"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> TDD rebooted </h3> <h4 id="the-zen-of-tdd"> <a href="#the-zen-of-tdd" class="anchor-heading" aria-labelledby="the-zen-of-tdd"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> The Zen of TDD </h4> <ul> <li>Avoid testing implementation details, test behaviours. Test intent has to be explicit about this, high-level details. <ul> <li>Adding a new class is not the trigger for writing tests. The trigger is implementing a requirement.</li> <li>Test outside-in, writing tests to cover then the use cases, scenarios. You have to test the domain, if you test through forms (MVC), the moment you change your delivery mechanism you break all the tests. You should test the surface. Don’t test the internals, you’d be coupling your test to internal details.</li> <li>Only writing test to cover the implementation details as a way to understand the refactoring of the simple implementation we start with.</li> </ul> </li> </ul> <p>BDD (Dan North), we should test behaviours, not tests. People misunderstand what TDD is all about.</p> <p>Kent explicitly talks about behaviours, with examples. Testing the perimeter surface, not the implementation details.</p> <h4 id="what-is-a-unit-test"> <a href="#what-is-a-unit-test" class="anchor-heading" aria-labelledby="what-is-a-unit-test"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> What is a unit test </h4> <ul> <li>For Kent Beck, it is a test that <em>runs in isolation</em> from other tests. <ul> <li>Nothing more, nothing less.</li> <li>It is NOT to be confused with the classical unit test definition of targeting a module.</li> <li>We don’t touch file system, database, because these <em>shared fixture</em> elements prevent us running in isolation from other tests (side-effects.)</li> </ul> </li> <li>Explicitly writing tests that target a method on a clas, is not a TDD unit tests <ul> <li>TDD unit tests focus on a story. Use-case, scenario…</li> </ul> </li> <li>Focusing on methods creates tests that are hard to maintain. We don’t capture the behaviour we want to preserve.</li> </ul> <p>A lot of issues with TDD is people misunderstanding <em>isolation</em> as <em>class isolation</em>, replacing collaborators with test doubles.</p> <h3 id="red-green-refactor"> <a href="#red-green-refactor" class="anchor-heading" aria-labelledby="red-green-refactor"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Red-green-refactor </h3> <ol> <li><strong>Red</strong> Write a little test that doesn’t work, and perhaps doesn’t even compile at first.</li> <li><strong>Green</strong> Make the test work quickly, commiting whatever sins necessary in the process.</li> <li><strong>Refactor</strong> Eliminate all of the duplication, created in merely getting the test to work.</li> </ol> <h4 id="the-simplest-thing-green"> <a href="#the-simplest-thing-green" class="anchor-heading" aria-labelledby="the-simplest-thing-green"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> The simplest thing (green) </h4> <ul> <li>Make it run. Quickly getting that bar to go green domintates everything else.</li> <li>The shift in aesthetics is hard for some experienced software engineers. <ul> <li>The only know how to follow the rules of good engineering.</li> <li>Quick green excuses all sins.</li> <li>This is not about accepting sin, its about being sinful.</li> <li>Write sinful code!</li> </ul> </li> </ul> <p>This is difficult fir experienced engineers, we tend to think on how to engineer the problem, not how to solve it fast.</p> <blockquote> <p>We can commit any number of sins to get there, because speed trumps design, just for a brief moment. - Kent Beck</p> </blockquote> <blockquote> <p>Good design at good times. Make it run, make it right. - Kent Beck</p> </blockquote> <h4 id="clean-code-now-refactor"> <a href="#clean-code-now-refactor" class="anchor-heading" aria-labelledby="clean-code-now-refactor"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Clean code now (refactor) </h4> <ul> <li>The refactoring step is when we produce clean code. <ul> <li>It’s when you apply patterns</li> <li>It’s when you remove duplication</li> <li>It’s when you sanitise the code smells</li> </ul> </li> <li><strong>You do not write new unit tests here</strong> <ul> <li>You are not introducing public classes</li> <li>It is likely if you feel you need, you need collaborators to fulfill a role</li> </ul> </li> </ul> <p>If you add more tests at this point, you’ll be coupling your tests to implementation details, making your tests fragile. Your API is your contract, your tests should test the API, not the implementation details. Coupling is the first problem in software.</p> <ul> <li>We need to eliminate dependency between our tests and our code <ul> <li>Tests should not depend on details, because then changing implementation breaks tests. Tests should depend on contracts or public interfaces.</li> <li>This allows us to refactor implementations without changing tests.</li> <li>Don’t bake implementation details into tests</li> </ul> </li> <li>Test behaviours not implementations</li> </ul> <p>Counter argument: The setup of this may be too complex as we testing super high-level.</p> <ul> <li>Don’t test internals</li> <li>Don’t make everything public in order to test it</li> <li>Preserve implementation hiding by keeping a thin public API</li> <li>Refactor implementation details out, so that they do not need their own tests</li> <li>Continue to refactor implementation details over time, as you want</li> <li>Have expressive tests that you can read in the future</li> </ul> <h3 id="refactoring-to-patterns"> <a href="#refactoring-to-patterns" class="anchor-heading" aria-labelledby="refactoring-to-patterns"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Refactoring to patterns </h3> <p>Patterns emerge in refactoring step. You don’t think on patterns first an implementations later.</p> <p>References: TDD by Example (Kent Beck), Refactoring to Patterns (Joshua)</p> <h3 id="port-and-adapters"> <a href="#port-and-adapters" class="anchor-heading" aria-labelledby="port-and-adapters"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Port and adapters </h3> <p>Testing ice-cream cone anti-pattern.</p> <p>Testing piramid.</p> <p>UI: We are not testing the domain logic, we are testing the widgets.</p> <p>Integration: Tests cannot run in isolation if we have shared state fixtures like databases, etc. Here we do test that kind of stuff.</p> <p>Unit: To test the business logic. The tests are more valuable and less costly are unit tests.</p> <h4 id="hexagonal-architecture"> <a href="#hexagonal-architecture" class="anchor-heading" aria-labelledby="hexagonal-architecture"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Hexagonal architecture </h4> <p>We unit test the port, the use case. We test the behaviour, the contract to the world.</p> <p>We don’t test the implementation details (peg: the database).</p> <p>Integraiton tests: Don’t test things you don’t own. Just test that you are using them correctly.</p> <p>System tests: Tests that verify that everything works.</p> <h3 id="gears"> <a href="#gears" class="anchor-heading" aria-labelledby="gears"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Gears </h3> <p>We can be in the motorway driving in the fifth gear, that’s may be the operational mode while developing, but sometimes we need to start changing down the gears.</p> <p>Fifth gear is “obvious implementation”, we can go straight to green. You may write unnecessary code.</p> <p>Fourth gear is “we are writing code nicely”, we start to think we don’t know how to get to the solution so write some tests, some implementation details (drilling tests) to see how it may look. You need to think about behaviour. Maybe you want to remove those implementation tests once you finish with the behaviour.</p> <p>You should test the ports, not implementation details.</p> <p>You should be feel free to remove tests if necessary. The tests we need to keep are the tests that express the behaviour, the API of your system.</p> <h3 id="acceptance-test-driven-development"> <a href="#acceptance-test-driven-development" class="anchor-heading" aria-labelledby="acceptance-test-driven-development"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Acceptance test-driven development </h3> <p>Customers should be available to write scenarios for tests. Getting the customer chain together for this is problematic.</p> <p>Unit tests evolve into “programmer tests”. ATDD is more about high-level communication.</p> <p><strong>If customers do not participate, it does not make any sense</strong>. Expensive to write, expensive to run (Fitness, Cucumber).</p> <p>Maybe we should involve customers while writting unit tests and focus on unit tests. The problem is programmers making programmer driven tests instead of behaviour driven tests, so let’s solve that.</p> <h3 id="behaviour-driven-development"> <a href="#behaviour-driven-development" class="anchor-heading" aria-labelledby="behaviour-driven-development"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Behaviour-driven development </h3> <p>BDD starts with a similiar inisght, that we misunderstood TDD.</p> <ul> <li>It creates tools like RSpec and Jbehave</li> <li>It realises that specifying scenarios is the key to driving test-driven development</li> <li>It evolves into a methodology for facilitating the transmission of requirements from customer to developer through scenarios that can be automated.</li> </ul> <h3 id="mocks"> <a href="#mocks" class="anchor-heading" aria-labelledby="mocks"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Mocks </h3> <ul> <li>Classic example is database <ul> <li>Long time to start</li> <li>Difficult to keep “clean”</li> <li>Tie tests to physical location on network</li> <li>Write tests against something that acts like a DB</li> </ul> </li> <li>Mocks can improve readability by making contents of read rows explicit (evident data)</li> <li>Mocks hinder the use of singletons <ul> <li>Which may be a good thing</li> </ul> </li> <li>Mocks make us consider issues around coupling <ul> <li>We learn to inject dependencies</li> </ul> </li> <li>Mocks risk that the real system will not perform in the correct way</li> </ul> <p>Two forces</p> <ul> <li>We want to remove “hard-to-test” dependencies <ul> <li>Database, UI, network, file system, configuration files, etc.</li> <li>Depending on these makes our tests fragile</li> </ul> </li> <li>We want to use Responsibility Driven Design and mock collaborators <ul> <li>Tell don’t ask</li> <li>But don’t mock internals</li> </ul> </li> </ul> <p>You do not mock the internals or implementation details, so couple to the implementation details with the mocks, mock other ports and other publics (APIs). Don’t mock adapters either, do not mock things you don’t own.</p> <h3 id="object-mother-and-test-data-builder"> <a href="#object-mother-and-test-data-builder" class="anchor-heading" aria-labelledby="object-mother-and-test-data-builder"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Object Mother and Test Data Builder </h3> <p>This is how you control complex setups for larger testing clusters (big setup).</p> <ul> <li>An early solution was objet mother <ul> <li>A class that contains static factory methods used to create obejcts for use in tests</li> <li>The name of the method helps identify the sterotypical object being created</li> <li>The concept was that devevelopers would become faimiliar with the objects and use them in scenarios</li> </ul> </li> </ul> <p>Problems with Object Mother</p> <ul> <li>Variations in testing mean we end up with many different factory methods. Object mother soon becomes bloated</li> <li>The variables affecting the test are not evident, but hidden behind the creation mechanism. If you don’t know the Object Mother test data, tests are obscure.</li> <li>The factory methods become shared fixture, which means that changes to construction ripple out</li> </ul> <p>A solution is using <strong>Test Data Builders</strong>. For each class you want to use in a test, create a Builder for that class that</p> <ul> <li>Has an instance variable for each constructor parameter</li> <li>Initialises its instance variables to commonly used or safe values</li> <li>Has a <code class="language-plaintext highlighter-rouge">build</code> method that creats a new object using the values in its instance variables. We can do a neat trick with conversion operators too</li> <li>Has a “chainable” public methods for overriding the values in its instance variables</li> </ul> <h2 id="summary"> <a href="#summary" class="anchor-heading" aria-labelledby="summary"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Summary </h2> <ul> <li>The reason to test is a new behaviour, not a method on a class</li> <li>Write dirty code to get green, then refactor</li> <li>No new tests for refactored itnernals and privates (methods, classes)</li> <li>Both develop and accept against tests written on a port</li> <li>Add integration tests for coverage of ports to adapters</li> <li>Add system tests for end-to-end confidence</li> <li>Don’t mock internals, privates, or adapters</li> </ul> </div> </div> <div class="search-overlay"></div> </div> </body> </html>
