<!DOCTYPE html> <html lang="en-US"> <head> <meta charset="UTF-8"> <meta http-equiv="X-UA-Compatible" content="IE=Edge"> <link rel="shortcut icon" href="/learning-notes/favicon.ico" type="image/x-icon"> <link rel="stylesheet" href="/learning-notes/assets/css/just-the-docs-default.css"> <script type="text/javascript" src="/learning-notes/assets/js/vendor/lunr.min.js"></script> <script type="text/javascript" src="/learning-notes/assets/js/just-the-docs.js"></script> <meta name="viewport" content="width=device-width, initial-scale=1"> <!-- Begin Jekyll SEO tag v2.7.1 --> <title>Test-Driven Development: By Example | Notes</title> <meta name="generator" content="Jekyll v3.9.0" /> <meta property="og:title" content="Test-Driven Development: By Example" /> <meta property="og:locale" content="en_US" /> <meta name="description" content="Keyvan Akbary learning notes" /> <meta property="og:description" content="Keyvan Akbary learning notes" /> <meta property="og:site_name" content="Notes" /> <meta name="twitter:card" content="summary" /> <meta property="twitter:title" content="Test-Driven Development: By Example" /> <script type="application/ld+json"> {"headline":"Test-Driven Development: By Example","description":"Keyvan Akbary learning notes","@type":"WebPage","url":"/learning-notes/books/test-driven-development/","@context":"https://schema.org"}</script> <!-- End Jekyll SEO tag --> </head> <body> <svg xmlns="http://www.w3.org/2000/svg" style="display: none;"> <symbol id="svg-link" viewBox="0 0 24 24"> <title>Link</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"> <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-search" viewBox="0 0 24 24"> <title>Search</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"> <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </symbol> <symbol id="svg-menu" viewBox="0 0 24 24"> <title>Menu</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"> <line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewBox="0 0 24 24"> <title>Expand</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"> <polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <symbol id="svg-doc" viewBox="0 0 24 24"> <title>Document</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"> <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> </svg> <div class="side-bar"> <div class="site-header"> <a href="/learning-notes/" class="site-title lh-tight"> Notes </a> <a href="#" id="menu-button" class="site-button"> <svg viewBox="0 0 24 24" class="icon"><use xlink:href="#svg-menu"></use></svg> </a> </div> <nav role="navigation" aria-label="Main" id="site-nav" class="site-nav"> <ul class="nav-list"><li class="nav-list-item"><a href="/learning-notes/" class="nav-list-link">Home</a></li><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/learning-notes/articles/" class="nav-list-link">Articles</a><ul class="nav-list "></ul></li><li class="nav-list-item active"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/learning-notes/books/" class="nav-list-link">Books</a><ul class="nav-list "></ul></li><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/learning-notes/talks/" class="nav-list-link">Talks</a><ul class="nav-list "></ul></li><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/learning-notes/papers/" class="nav-list-link">Papers</a><ul class="nav-list "></ul></li></ul> </nav> <footer class="site-footer"> This site uses <a href="https://github.com/pmarsceill/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll. </footer> </div> <div class="main" id="top"> <div id="main-header" class="main-header"> <div class="search"> <div class="search-input-wrap"> <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search Notes" aria-label="Search Notes" autocomplete="off"> <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label> </div> <div id="search-results" class="search-results"></div> </div> <nav aria-label="Auxiliary" class="aux-nav"> <ul class="aux-nav-list"> <li class="aux-nav-list-item"> <a href="//github.com/keyvanakbary/learning-notes" class="site-button" > Learning Notes on GitHub </a> </li> </ul> </nav> </div> <div id="main-content-wrap" class="main-content-wrap"> <nav aria-label="Breadcrumb" class="breadcrumb-nav"> <ol class="breadcrumb-nav-list"> <li class="breadcrumb-nav-list-item"><a href="/learning-notes/books/">Books</a></li> <li class="breadcrumb-nav-list-item"><span>Test-Driven Development: By Example</span></li> </ol> </nav> <div id="main-content" class="main-content" role="main"> <h1 id="test-driven-development-by-example"> <a href="#test-driven-development-by-example" class="anchor-heading" aria-labelledby="test-driven-development-by-example"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <a href="https://www.goodreads.com/book/show/387190.Test_Driven_Development">Test-Driven Development: By Example</a> </h1> <ul> <li><a href="#tdd-videos">TDD videos</a></li> <li><a href="#preface">Preface</a></li> <li><a href="#money-session">Money session</a></li> <li><a href="#xunit-session">Xunit session</a></li> <li><a href="#test-driven-development-patterns">Test-Driven Development Patterns</a></li> <li><a href="#red-bar-patterns">Red bar patterns</a></li> <li><a href="#red-bar-patterns-1">Red bar patterns</a></li> <li><a href="#green-bar-patterns">Green bar patterns</a></li> <li><a href="#design-patterns">Design patterns</a></li> <li><a href="#refactoring">Refactoring</a></li> <li><a href="#mastering-tdd">Mastering TDD</a></li> </ul> <h2 id="tdd-videos"> <a href="#tdd-videos" class="anchor-heading" aria-labelledby="tdd-videos"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> TDD videos </h2> <p>I skipped the TDD sessions in the book, <em>Money Pattern</em> with Java and <em>implementing xUnit</em> with Python, so the summary can focus on the learnings. Some interesting videos on TDD</p> <ul> <li><a href="https://www.youtube.com/watch?v=VVSSga1Olt8">TDD intro by Kent Beck</a></li> <li><a href="https://www.youtube.com/watch?v=nIonZ6-4nuU">Making making CoffeeScript by Kent Beck</a></li> <li><a href="https://www.youtube.com/watch?v=qkblc5WRn-U">The Three Laws of TDD by Uncle Bob</a></li> </ul> <h2 id="preface"> <a href="#preface" class="anchor-heading" aria-labelledby="preface"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Preface </h2> <p>Two simple rules:</p> <ul> <li>Write new code only when you first have a failing automated test.</li> <li>Eliminate duplication</li> </ul> <p>The technical implications of these two simple rules:</p> <ul> <li>Design organically</li> <li>Write your own tests</li> <li>Provide rapid response to small changes</li> <li>Design highly cohesive, loosely coupled components, just to make testing easy.</li> </ul> <p>Order of programming tasks:</p> <ol> <li><strong>Red</strong>: Write a little test that doesn’t work, perhaps doesn’t even compiler</li> <li><strong>Green</strong>: Make the test work quickly, committing whatever sins necessary in the process</li> <li><strong>Refactor</strong>: Eliminate all the duplication created in just getting the test to work</li> </ol> <p>Why would a programmer work in tiny little steps when their mind is capable of great soaring swoops of design? Courage.</p> <h3 id="courage"> <a href="#courage" class="anchor-heading" aria-labelledby="courage"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Courage </h3> <p>Test-driven development is a way of managing fear during programming, this-is-a-hard-problem-and-I-can’t-see-the-end-from-the-beginning.</p> <p>TDD isn’t an absolute like Extreme Programming. TDD is an awareness of the gap between decision and feedback during programming, and techniques to control that gap.</p> <p>There are certainly programming task that can’t be driven solely by tests, like security software and concurrency.</p> <blockquote> <p>My goal is to write clean code that works. Imagining a programming world in which all code was this clear and direct, where there were no complicated solutions, only apparently complicated problems begging for careful thought. TDD is a practice that can help you lead yourself exactly that careful thought.</p> </blockquote> <h3 id="story-time"> <a href="#story-time" class="anchor-heading" aria-labelledby="story-time"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Story time </h3> <p>TDD is a set of techniques any programmer can follow, that encourage simple designs and test suites that inspire confidence. <em>If you are a genius, you don’t need these rules.</em> If you are dolt, the rules won’t help.</p> <p>Two rules:</p> <ul> <li>Write a failing automated test before you write any code.</li> <li>Remove duplication</li> </ul> <h2 id="money-session"> <a href="#money-session" class="anchor-heading" aria-labelledby="money-session"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Money session </h2> <p>The rhythm of TDD:</p> <ol> <li>Quickly add a test</li> <li>Run all the tests and see the new one fail</li> <li>Make a little change</li> <li>Run all tests and see them all succeed</li> <li>Refactor to remove duplication</li> </ol> <h4 id="create-a-test"> <a href="#create-a-test" class="anchor-heading" aria-labelledby="create-a-test"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Create a test </h4> <p>We don’t start with objects, we start with tests.</p> <p>When we write a test, we imagine the perfect interface for our operation. We are telling ourselves a store about how the operation will look from the outside. Our story wont’ always come true, but better to start from the best possible API and work backwards than to make things complicated, ugly and “realistic” from the get go.</p> <p>You’ll might end up with multiple compile errors from a single test. It’s common to start from the following code when non of the code exists yet.</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kt">void</span> <span class="nf">testMultiplication</span><span class="o">()</span> <span class="o">{</span>
  <span class="nc">Dollar</span> <span class="n">five</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Dollar</span><span class="o">(</span><span class="mi">5</span><span class="o">);</span>

  <span class="n">five</span><span class="o">.</span><span class="na">times</span><span class="o">(</span><span class="mi">2</span><span class="o">);</span>

  <span class="n">assertEquals</span><span class="o">(</span><span class="mi">10</span><span class="o">,</span> <span class="n">five</span><span class="o">.</span><span class="na">amount</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></div></div> <p>We might need a constructor, but it doesn’t have to do anything. We might need a stub implementation for methods.</p> <p><strong>We’ll do the least work possible just to get the test to compile.</strong></p> <p>Once we solve compilation errors, we run the test and we watch it fail. Failure is progress. We’ve transformed a much broader problem to “make this test work and make the rest of the tests work”, which is in fact a much simpler and much smaller scope for fear.</p> <h4 id="make-it-pass"> <a href="#make-it-pass" class="anchor-heading" aria-labelledby="make-it-pass"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Make it pass </h4> <p>The goal right now is not to get the perfect answer, the goal is to pass the test.</p> <h4 id="make-it-right"> <a href="#make-it-right" class="anchor-heading" aria-labelledby="make-it-right"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Make it right </h4> <p>Dependency is the key problem in software development at all scales. If dependency is the problem, duplication is the symptom.</p> <p>Objects are excellent for abstracting away the duplication of logic. Eliminating duplication in programs eliminates dependency. By eliminating duplication before we go on the next test, we maximize our chance of being able to get the next test running with one and only one change.</p> <h3 id="degenerate-objects"> <a href="#degenerate-objects" class="anchor-heading" aria-labelledby="degenerate-objects"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Degenerate objects </h3> <p>The general TDD cycle</p> <ol> <li><strong>Write a test.</strong> You are writing a story. Invent the interface you wish you had. Include all the elements int he story that you imagine will be necessary to calculate the right answers.</li> <li><strong>Make it run.</strong> Quickly getting that bar green dominates everything else.</li> <li><strong>Make it right.</strong> Remove the duplication you have introduced to get to quick green. The goal is clean code that works.</li> </ol> <p>Divide an conquer, solve the “that works” part, then solve the “clean code”.</p> <p>Strategies for quickly getting to green:</p> <ul> <li><strong>Fake it</strong>, return a constant and gradually replace constants with variables until you have the real code.</li> <li><strong>Obvious implementation</strong>, type in the real implementation.</li> </ul> <p>When you know what to type, go for the obvious implementation. As soon as you get the unexpected red bar, back up and shift to fake implementation and refactor to the right code. Once confidence is back, go back to obvious implementation.</p> <h3 id="equality-for-all"> <a href="#equality-for-all" class="anchor-heading" aria-labelledby="equality-for-all"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Equality for all </h3> <p>There is a third strategy, <strong>triangulation</strong>. We briefly ignore the duplication between test and model code. When the second example demands a more general solution, then and only then do we generalize.</p> <p>Use triangulation when you are completely unsure of how to refactor.</p> <blockquote> <p>Why would I need to write another test to give me permission to write what I probably could have written the first time?</p> </blockquote> <p>Triangulation gives you a chance to think about the problem from slightly different direction. By varying the axes of variability to get a clearer answer.</p> <h3 id="privacy"> <a href="#privacy" class="anchor-heading" aria-labelledby="privacy"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Privacy </h3> <p>From time to time, our reasoning will fail us and a defeat will slip through. When that happens, we learn our lesson about the test we should have written and move on.</p> <h3 id="equality-for-all-redux"> <a href="#equality-for-all-redux" class="anchor-heading" aria-labelledby="equality-for-all-redux"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Equality for all, redux </h3> <p>When you don’t have enough tests, you are bound to come across refactorings that aren’t supported by tests. Write the tests you wish had. If you don’t, you’ll eventually break something while refactoring.</p> <h3 id="makin-objects"> <a href="#makin-objects" class="anchor-heading" aria-labelledby="makin-objects"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Makin’ objects </h3> <p>When you have two subclasses that aren’t doing enough work to justify their existence and you want to eliminate them, you can’t do it with one big step.</p> <p>We could be a step closer eliminating the subclasses if there were fewer references to the subclasses directly. We could use Factory Method in the parent class to remove references to the subclasses in the tests.</p> <p>By decoupling the tests from the existence of the subclasses, we have given ourselves freedom to change inheritance without affecting any model code.</p> <h3 id="time-were-livin-in"> <a href="#time-were-livin-in" class="anchor-heading" aria-labelledby="time-were-livin-in"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Time we’re livin’ in </h3> <p>Working in tiny steps is a recommendation, if it feels restrictive take bigger steps. If you feel unsure, take smaller steps. TDD is a steering process.</p> <h3 id="interesting-times"> <a href="#interesting-times" class="anchor-heading" aria-labelledby="interesting-times"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Interesting times </h3> <p>We end up having clean code and tests that give us confidence that the clean code works. Rather than apply minutes of suspect reasoning, we can just ask the computer by making the change and running tests.</p> <p>Without the tests you have no choice, you have to reason. With the tests you can decide whether an experiment would answer the question faster.</p> <p>We’d prefer not to write a test when we have a red bar. We can’t change model code without a test. The conservative course is back our the change that caused the red bar so we’re back to green. Then we change the test, the implementation and re-try the original change.</p> <h3 id="the-root-of-all-evil"> <a href="#the-root-of-all-evil" class="anchor-heading" aria-labelledby="the-root-of-all-evil"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> The root of all evil </h3> <p>When the object you have doesn’t behave like you want, make another object with the same external protocol (an Imposter) but different implementation.</p> <p>TDD can’t guarantee that you will have flashes of insight at the right moment. However, confidence-giving tests and carefully factored code give you preparation for insight, and preparation for applying that insight when it comes.</p> <h3 id="change"> <a href="#change" class="anchor-heading" aria-labelledby="change"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Change </h3> <p>No need for writing tests for <code class="language-plaintext highlighter-rouge">equals()</code> and <code class="language-plaintext highlighter-rouge">hashCode()</code> as we are writing those in the context of a refactoring.</p> <h3 id="abstraction-finally"> <a href="#abstraction-finally" class="anchor-heading" aria-labelledby="abstraction-finally"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Abstraction, finally </h3> <p>For TDD to make economic sense, either you will have to be able to write twice as many lines per day as before, or write half as many lines for the same functionality. You’ll have to measure and see effect TDD has on your own practice. Be sure to factor debugging, integrating, and explaining time into your metrics, though.</p> <p>TDD can be used as a way to strive for perfection, but that isn’t its most effective use. If you have a big system, the parts that you touch all the time should be absolutely rock solid, so you can make daily changes confidently.</p> <h3 id="retrospective"> <a href="#retrospective" class="anchor-heading" aria-labelledby="retrospective"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Retrospective </h3> <blockquote> <p>I like running a code critic. Automated critics don’t forget, if you don’t delete an obsolete implementation, you don’t have to stress. The critic will point it out.</p> </blockquote> <p>The number of changes per refactoring should follow a “fat tail”.</p> <h4 id="test-quality"> <a href="#test-quality" class="anchor-heading" aria-labelledby="test-quality"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Test quality </h4> <p>Coverage is certainly not a sufficient measure of test quality, but it is a starting place. Another way of evaluating test quality is defect insertion. The idea is simple, change the meaning of a line of code and a test should break.</p> <h4 id="one-last-review"> <a href="#one-last-review" class="anchor-heading" aria-labelledby="one-last-review"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> One last review </h4> <p>The three items that come up time and again as surprises when teaching TDD are</p> <ul> <li>The three approaches to making a test work cleanly: fake it, triangulate and just typing the right solution to begin with.</li> <li>Removing duplication between test and code as a way to drive the design.</li> <li>The ability to control the gap between tests to increase traction when the road gets slippery and cruise faster when conditions are clearer.</li> </ul> <h2 id="xunit-session"> <a href="#xunit-session" class="anchor-heading" aria-labelledby="xunit-session"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Xunit session </h2> <h3 id="invoke-test-method"> <a href="#invoke-test-method" class="anchor-heading" aria-labelledby="invoke-test-method"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Invoke test method </h3> <p>Lots of refactoring has this feel, separating two parts so you can work on them separately. If they go back together when you are finished, fine, if not, you can leave them separate.</p> <p>Another general pattern of refactoring, take code that works in one instance and generalize it to work in many by replacing constants with variables.</p> <p>Starting from scratch is about the worst possible case for TDD, because we are trying to get over the bootstrap step. Once you mastered TDD, you will be able to work in much bigger leaps of functionality.</p> <h3 id="set-the-table"> <a href="#set-the-table" class="anchor-heading" aria-labelledby="set-the-table"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Set the table </h3> <p>Patterns inside tests:</p> <ol> <li>Arrange, create some objects.</li> <li>Act, stimulate them.</li> <li>Assert, check the results.</li> </ol> <p>Two common constraints on tests come into conflict:</p> <ul> <li><em>Performance</em>, we would like to run as quickly as possible and that might mean to share objects between tests.</li> <li><em>Isolation</em>, we would like the success or failure of one test to be irrelevant to other tests.</li> </ul> <p>One test can be simple if and only if another test is in place and running correctly. Simplicity of test writing is more important than performance.</p> <h3 id="cleaning-up-after"> <a href="#cleaning-up-after" class="anchor-heading" aria-labelledby="cleaning-up-after"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Cleaning up after </h3> <p>Doing a refactoring based on a couple of early uses, then having to undo it soon after is fairly common.</p> <h3 id="retrospective-1"> <a href="#retrospective-1" class="anchor-heading" aria-labelledby="retrospective-1"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Retrospective </h3> <p>The details of the implementation are not nearly as important as the test cases.</p> <h2 id="test-driven-development-patterns"> <a href="#test-driven-development-patterns" class="anchor-heading" aria-labelledby="test-driven-development-patterns"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Test-Driven Development Patterns </h2> <h3 id="test-n"> <a href="#test-n" class="anchor-heading" aria-labelledby="test-n"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Test <em>n</em> </h3> <p>No programmers release even the tiniest change without testing, except the very confident and the very sloppy.</p> <p>Be careful with the positive feedback of not listening to stress and avoiding tests: The more stress you feel, the less testing you’ll do. The less testing you do, the more errors you will make. The more errors you make, the more stress you feel.</p> <p>With automated tests, when you start to feel stress, just run the tests. With automated tests you have a chance to choose your level of fear.</p> <h3 id="isolated-test"> <a href="#isolated-test" class="anchor-heading" aria-labelledby="isolated-test"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Isolated test </h3> <p><strong>Make the tests so fast to run that you can run them yourself, and run them often. That way you can catch errors before anyone else sees them.</strong></p> <p>Tests should be able to ignore each other completely. If you have one test broken, you want to have one problem. If you have two tests broken, you want to have two problems.</p> <p>Isolating tests encourages you to compose solutions out of many highly cohesive, loosely coupled objects.</p> <blockquote> <p>I never knew exactly how to regularly achieve high cohesion and loose coupling until I started writing isolated tests.</p> </blockquote> <h3 id="test-list"> <a href="#test-list" class="anchor-heading" aria-labelledby="test-list"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Test list </h3> <p>The first part of our strategy for dealing with programming stress is to never take a step forward unless we know where our foot is going to land.</p> <p>What is it we intend to accomplish? One strategy for keeping track of what we’re trying to accomplish is to hold it all in our heads.</p> <blockquote> <p>I tried this for several years, and found I got into a positive feedback loop. The more experience I accumulated, the more things I knew that might need to be done. The more things I knew might need to be done, the less attention I had for what I was doing. The less attention I had for what I was doing, the less I accomplished. The less I accomplished, the more things I knew that needed to be done.</p> </blockquote> <p>Another strategy is to try to plan everything in advance and implement tests <em>en masse</em>.</p> <p>Probably the best option is to always test first. Then we can get into a virtuous cycle: When we test first, we reduce the stress, which makes us more likely to test. The immediate payoff for testing, a design and scope control tool, suggests that we will be able to start doing it, and keep doing it even under moderate stress.</p> <h3 id="assert-first"> <a href="#assert-first" class="anchor-heading" aria-labelledby="assert-first"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Assert first </h3> <ul> <li>Where should you start building a system? With stories you want to be able to tell about the finished system.</li> <li>Where should you start writing a bit of functionality? With the tests you want to pass with the finished code.</li> <li>Where should you start writing a test? With the asserts that will pass when it is done.</li> </ul> <h3 id="test-data"> <a href="#test-data" class="anchor-heading" aria-labelledby="test-data"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Test data </h3> <p>Use data that makes the tests easy to read and follow. Don’t have a list of 10 items as the input data if a list of 3 items will lead you the same design and implementation decisions.</p> <p>The alternative to Test Data is Realistic Data, where you use data from the real world. Realistic Data is useful when:</p> <ul> <li>You are testing real-time systems using traces of external events</li> <li>You are matching the output of the current system with output of the previous system.</li> <li>You are refactoring a simulation and expect precisely the same answers when you are finished.</li> </ul> <h3 id="evident-data"> <a href="#evident-data" class="anchor-heading" aria-labelledby="evident-data"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Evident data </h3> <p>The intent of data should be represented including expected and actual results in the test itself, trying to make their relationship apparent. Remember, you are writing the tests for the reader, not just the computer.</p> <h2 id="red-bar-patterns"> <a href="#red-bar-patterns" class="anchor-heading" aria-labelledby="red-bar-patterns"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Red bar patterns </h2> <p>If you don’t find any test on the list that represents one step, add some new tests that would represent progress towards the items there.</p> <h3 id="starter-test"> <a href="#starter-test" class="anchor-heading" aria-labelledby="starter-test"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Starter test </h3> <p>The first question you have to ask with a new operation is “Where does it belong?”</p> <p>Beginning with a realistic test will leave you too long without feedback. You can shorten the loop by choosing inputs and outputs that are trivially easy to discover.</p> <h3 id="explanation-test"> <a href="#explanation-test" class="anchor-heading" aria-labelledby="explanation-test"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Explanation test </h3> <p>Ask for and give explanations in terms of tests.</p> <h3 id="another-test"> <a href="#another-test" class="anchor-heading" aria-labelledby="another-test"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Another test </h3> <p>When a technical discussion is straying off topic with a tangential idea, add a test to the list and go back to the topic.</p> <p>New ideas are greeted with respect, but not allowed to divert the attention. You write them down on the list and get back to what you were working on.</p> <h3 id="regression-test"> <a href="#regression-test" class="anchor-heading" aria-labelledby="regression-test"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Regression test </h3> <p>When a defect is reported write the smallest possible test that fails, and once it runs, the defect will be repaired.</p> <h3 id="break"> <a href="#break" class="anchor-heading" aria-labelledby="break"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Break </h3> <p>When you feel tired or stuck take a break.</p> <p><strong>Shower methodology</strong>: if you know what to type, type. If you don’t know what to type, take a shower.</p> <p>TDD is a refinement of that strategy, if you don’t know what to type, fake it. If the “right” design still isn’t clear, triangulate. If you still don’t know hat to type, then you can take that shower.</p> <h2 id="red-bar-patterns-1"> <a href="#red-bar-patterns-1" class="anchor-heading" aria-labelledby="red-bar-patterns-1"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Red bar patterns </h2> <ul> <li>At the scale of a week, weekend commitments help get your conscious, energy-sucking thoughts off work.</li> <li>At the scale of a year, mandatory vacation policies help you refresh yourself completely.</li> </ul> <h3 id="do-over"> <a href="#do-over" class="anchor-heading" aria-labelledby="do-over"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Do over </h3> <p>When you are feeling lost throw away the code and start over.</p> <p>If you pair program, switching partners is a good way to motivate productive do overs.</p> <h3 id="child-test"> <a href="#child-test" class="anchor-heading" aria-labelledby="child-test"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Child test </h3> <p>How do you get a test case running that turns out to be too big? Write a smaller test case that represents the broken part of the bigger test case.</p> <h3 id="mock-object"> <a href="#mock-object" class="anchor-heading" aria-labelledby="mock-object"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Mock object </h3> <p>In order to test an object that relies on an expensive or complicated resource, you create a fake version of the resource that answers constants.</p> <p>Mock objects add a risk to the project, what if the mock doesn’t behave like the real object? You can reduce this strategy by having a set of tests for the mock that can also be applied to the real object when it becomes available.</p> <h3 id="self-shunt"> <a href="#self-shunt" class="anchor-heading" aria-labelledby="self-shunt"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Self Shunt </h3> <p>How do you test one object communicates correctly with another? Have the object under test communicate with the test case instead of the object it expects.</p> <p>We don’t need Spy objects.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">testNotification</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="bp">self</span><span class="p">.</span><span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">TestResult</span><span class="p">()</span>
    <span class="n">result</span><span class="p">.</span><span class="n">addListener</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
    <span class="n">WasRun</span><span class="p">(</span><span class="s">"testMethod"</span><span class="p">).</span><span class="n">run</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
    <span class="k">assert</span> <span class="mi">1</span> <span class="o">==</span> <span class="bp">self</span><span class="p">.</span><span class="n">count</span>

<span class="k">def</span> <span class="nf">startTest</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
  <span class="bp">self</span><span class="p">.</span><span class="n">count</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">count</span> <span class="o">+</span> <span class="mi">1</span>
</code></pre></div></div> <p>Self Shunt tend to read better than tests written without.</p> <h3 id="log-string"> <a href="#log-string" class="anchor-heading" aria-labelledby="log-string"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Log string </h3> <p>If you want to test that a sequence of messages are called correctly, keep a log in a string, and append to the string when a message is called.</p> <p>Log strings are particularly useful when implementing Observer and you expect notifications to come at certain order. It works well with Self Shunt.</p> <h3 id="crash-test-dummy"> <a href="#crash-test-dummy" class="anchor-heading" aria-labelledby="crash-test-dummy"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Crash test dummy </h3> <p>If you want to test the flow for an error code, invoke a special object that throws an exception instead of doing real work.</p> <h3 id="broken-test"> <a href="#broken-test" class="anchor-heading" aria-labelledby="broken-test"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Broken test </h3> <p>How do you leave a programming session when you are programming alone? Leave the last test broken. When you come back to the code, you have an obvious, concrete bookmark to help you remember.</p> <h3 id="clean-check-in"> <a href="#clean-check-in" class="anchor-heading" aria-labelledby="clean-check-in"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Clean check-in </h3> <p>How do you leave a programming session when you are programming in a team? Leave all the tests running. When you are responsible to your teammates, the picture changes. You don’t know in detail what has happened to the code since you saw it last. You need to start from a place of confidence and certainty.</p> <h2 id="green-bar-patterns"> <a href="#green-bar-patterns" class="anchor-heading" aria-labelledby="green-bar-patterns"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Green bar patterns </h2> <h3 id="fake-it-til-you-make-it"> <a href="#fake-it-til-you-make-it" class="anchor-heading" aria-labelledby="fake-it-til-you-make-it"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Fake it (‘til you make it) </h3> <p>The first implementation once you have a broken test should returning a constant. Once you have the test running, gradually transform the constant into an expression using variables. Having something running is better than not having something running.</p> <p>Effects that make <em>fake it</em> powerful:</p> <ul> <li><strong>Psychological</strong>, having a green bar feels completely different than having a red bar.</li> <li><strong>Scope control</strong>, Starting with one concrete example and generalizing from there prevents you from prematurely confusing yourself with extraneous concerns.</li> </ul> <h3 id="triangulate"> <a href="#triangulate" class="anchor-heading" aria-labelledby="triangulate"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Triangulate </h3> <p>How do you most conservatively drive abstraction with tests? Only abstract when you have two or more examples.</p> <p>Once we have the two assertions and we have abstracted the correct implementation, we can delete one of the assertions on the grounds that it’s completely redundant with the other.</p> <blockquote> <p>I only use triangulation when I’m really, really unsure about the correct abstraction for the calculation</p> </blockquote> <h3 id="obvious-abstraction"> <a href="#obvious-abstraction" class="anchor-heading" aria-labelledby="obvious-abstraction"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Obvious abstraction </h3> <p>Sometimes you know how to implement an operation. Go ahead.</p> <p>Beware that solving “clean code” at the same time you solve “that works” can be too much to do at once.</p> <h3 id="one-to-many"> <a href="#one-to-many" class="anchor-heading" aria-labelledby="one-to-many"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> One to many </h3> <p>If you need to implement an operation that works with collection of objects, implement it first without collections and then make it work with them.</p> <h3 id="fixture"> <a href="#fixture" class="anchor-heading" aria-labelledby="fixture"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Fixture </h3> <p>When you need objects needed by several tests, convert local variables in the tests into instance variables. Sometimes one fixture serves to test several classes.</p> <h3 id="external-fixtures"> <a href="#external-fixtures" class="anchor-heading" aria-labelledby="external-fixtures"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> External fixtures </h3> <p>Release external resources in the <code class="language-plaintext highlighter-rouge">tearDown</code>. The goal of each test is to leave the world in exactly the same state as before it ran.</p> <h3 id="test-method"> <a href="#test-method" class="anchor-heading" aria-labelledby="test-method"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Test method </h3> <p>All the tests sharing a single fixture will be methods in the same class. Tests requiring a different fixture will be in a different class.</p> <p>The name of the method should suggest to a future clueless reader why this test was written.</p> <blockquote> <p>When I write tests, I first create a short outline of the tests I want to write like: // Adding to tuple spaces //// Taking a non-existing tuple // Taking from tuple to spaces</p> </blockquote> <h2 id="design-patterns"> <a href="#design-patterns" class="anchor-heading" aria-labelledby="design-patterns"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Design patterns </h2> <p>The design patterns book seems to have a subtle bias towards design as a phase. It certainly makes no nod towards refactorign as a design activity.</p> <h3 id="command"> <a href="#command" class="anchor-heading" aria-labelledby="command"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Command </h3> <p>When we need an invocation to be just a little more concrete and manipulable than a message, objects give us the answer. Make an object representing an invocation. Seed it with all the parameters the computation will need. When we’re ready to invoke it, use generic protocol like <code class="language-plaintext highlighter-rouge">run()</code>. Lambda would work pretty well in this case.</p> <h3 id="value-object"> <a href="#value-object" class="anchor-heading" aria-labelledby="value-object"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Value object </h3> <p>Objects are better than primitives because they are a great way to organize logic for later understanding and growth. However, there is one little problem.</p> <p><strong>Aliasing problem</strong>: If two objects share a reference to a third, if one object changes the referred object, the other object better not rely on the state of the shared object.</p> <p>One solution is to never give out the objects that you rely on, but instead to always make copies.</p> <p>Another solution is Observer, where you explicit register with objects on which you rely and expect to be notified when they change.</p> <p>Another solution is to treat the object as less than an object and eliminate the “that change over time”. Immutability and value is one of the core concepts of value objects. Every mutating operation just returns a new object. It makes reading and debugging so much easier.</p> <p>All value objects have to implement equality.</p> <h3 id="null-object"> <a href="#null-object" class="anchor-heading" aria-labelledby="null-object"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Null object </h3> <p>When you have a special case using objects, create an object representing the special case. Give it the same protocol as regular objects.</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">SecurityManager</span> <span class="n">security</span> <span class="o">=</span> <span class="nc">SecurityManager</span><span class="o">.</span><span class="na">getSecurityManager</span><span class="o">();</span>

<span class="k">if</span> <span class="o">(</span><span class="n">security</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">security</span><span class="o">.</span><span class="na">checkWrite</span><span class="o">(</span><span class="n">path</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></div></div> <p>to</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="nc">LaxSecurity</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">checkWrite</span><span class="o">(</span><span class="nc">String</span> <span class="n">path</span><span class="o">)</span> <span class="o">{</span>
    <span class="o">}</span>
<span class="o">}</span>
<span class="kd">class</span> <span class="nc">SecurityManager</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="nc">SecurityManager</span> <span class="nf">getSecurityManager</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">security</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">?</span> <span class="n">security</span> <span class="o">:</span> <span class="k">new</span> <span class="nc">LaxSecurity</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div> <p>Now we don’t have to worry about someone forgetting to check for <code class="language-plaintext highlighter-rouge">null</code>.</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">SecurityManager</span> <span class="n">security</span> <span class="o">=</span> <span class="nc">SecurityManager</span><span class="o">.</span><span class="na">getSecurityManager</span><span class="o">();</span>

<span class="n">security</span><span class="o">.</span><span class="na">checkWrite</span><span class="o">(</span><span class="n">path</span><span class="o">);</span>
</code></pre></div></div> <h3 id="template-method"> <a href="#template-method" class="anchor-heading" aria-labelledby="template-method"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Template method </h3> <p>A way of representing invariant sequence of a computation while providing for future refinement is to write a method that is implemented entirely in terms of other methods.</p> <p>A superclass can contain a method written entirely in terms of other methods, and subclasses can implement those methods in different ways.</p> <p>Template methods are best found through experience instead of designed that way from the beginning.</p> <h3 id="pluggable-object"> <a href="#pluggable-object" class="anchor-heading" aria-labelledby="pluggable-object"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Pluggable object </h3> <p>The simplest way to express variation is with explicit conditionals</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">if</span> <span class="o">(</span><span class="n">circle</span><span class="o">)</span> <span class="o">{</span>

<span class="o">}</span> <span class="k">else</span> <span class="o">{</span>

<span class="o">}</span>
</code></pre></div></div> <p>Such explicit decision making beings to spread.</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="nc">SelectionTool</span> <span class="o">{</span>
    <span class="nc">Figure</span> <span class="n">selected</span><span class="o">;</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">mouseDown</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">selected</span> <span class="o">=</span> <span class="n">findFigure</span><span class="o">();</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">selected</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span>
            <span class="n">select</span><span class="o">(</span><span class="n">selected</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">mouseMove</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">selected</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span>
            <span class="n">move</span><span class="o">(</span><span class="n">selected</span><span class="o">);</span>
        <span class="k">else</span>
            <span class="nf">moveSelectionRectangle</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">mouseUp</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">selected</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span>
            <span class="n">selectAll</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div> <p>The answer is to create Pluggable Object, a <code class="language-plaintext highlighter-rouge">SelectionMode</code> with two implementations <code class="language-plaintext highlighter-rouge">SingleSelection</code> and <code class="language-plaintext highlighter-rouge">MultipleSelection</code>.</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="nc">SelectionTool</span> <span class="o">{</span>
    <span class="nc">Figure</span> <span class="n">selected</span><span class="o">;</span>
    <span class="nc">SelectionMode</span> <span class="n">mode</span><span class="o">;</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">mouseDown</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">selected</span> <span class="o">=</span> <span class="n">findFigure</span><span class="o">();</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">selected</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span>
            <span class="n">mode</span> <span class="o">=</span> <span class="nc">SingleSelection</span><span class="o">(</span><span class="n">selected</span><span class="o">);</span>
        <span class="k">else</span>
            <span class="n">mode</span> <span class="o">=</span> <span class="nc">MultipleSelection</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">mouseMove</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">mode</span><span class="o">.</span><span class="na">mouseMove</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">mouseUp</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">mode</span><span class="o">.</span><span class="na">mouseUp</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div> <h3 id="pluggable-selector"> <a href="#pluggable-selector" class="anchor-heading" aria-labelledby="pluggable-selector"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Pluggable selector </h3> <p>If you want to invoke different behaviour for different instances, store the name of a method, and dynamically invoke it.</p> <p>When you have ten subclasses of a class, each implementing only one method, subclassing is a heavyweight mechanism.</p> <p>One alternative is to have a single class with a switch statement.</p> <p>The Pluggable Selector solution is to dynamically invoke the method using reflection</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">void</span> <span class="nf">print</span><span class="o">()</span> <span class="o">{</span>
    <span class="nc">Method</span> <span class="n">runMethod</span> <span class="o">=</span> <span class="n">getClass</span><span class="o">().</span><span class="na">getMethod</span><span class="o">(</span><span class="n">printMessage</span><span class="o">,</span> <span class="kc">null</span><span class="o">);</span>
    <span class="n">runMethod</span><span class="o">.</span><span class="na">invoke</span><span class="o">(</span><span class="k">this</span><span class="o">,</span> <span class="k">new</span> <span class="nc">Class</span><span class="o">[</span><span class="mi">0</span><span class="o">]);</span>
<span class="o">}</span>
</code></pre></div></div> <h3 id="factory-method"> <a href="#factory-method" class="anchor-heading" aria-labelledby="factory-method"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Factory method </h3> <p>When you want to create an object wanting flexibility creating the new object, create the object in a method instead of using a constructor. Constructor slack expressiveness and flexibility.</p> <p>By introducing a level of indirection, through a method, we gained the flexibility of returning an instance of a different class without changing the test.</p> <p>The downside of Factory Method is precisely its indirection. You’ll have to remember that the method is really creating an object. Use it when you need flexibility. Otherwise, constructors work just fine.</p> <h3 id="imposter"> <a href="#imposter" class="anchor-heading" aria-labelledby="imposter"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Imposter </h3> <p>When you want to introduce a new variation into a computation, introduce a new object with the same protocol as an existing object but with different implementation.</p> <p>Two examples of Imposters that come up frequently during refactoring:</p> <ul> <li><strong>Null Object</strong>, treat the absence of data the same as the presence of data.</li> <li><strong>Composite</strong>, treat a collection of objects the same as a single objects.</li> </ul> <p>Finding Imposters during refactoring is driven by eliminating duplication.</p> <h3 id="collecting-parameter"> <a href="#collecting-parameter" class="anchor-heading" aria-labelledby="collecting-parameter"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Collecting parameter </h3> <p>If you want to collect results spread over several objects, you add a parameter to the operation in which the results will be collected.</p> <h3 id="singleton"> <a href="#singleton" class="anchor-heading" aria-labelledby="singleton"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Singleton </h3> <p>Avoid providing global variables through singletons, think about the design instead.</p> <h2 id="refactoring"> <a href="#refactoring" class="anchor-heading" aria-labelledby="refactoring"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Refactoring </h2> <p>Usually, refactoring cannot change the semantics of a program under any circumstances. In TDD, the circumstances we care about are the tests that are already passing. We can replace constants with variables in TDD and call this operation a refactoring because it doesn’t change the set of tests to pass.</p> <blockquote> <p><em>Leap of faith</em> refactoring is exactly what we’re trying to avoid with our strategy of small steps and concrete feedback.</p> </blockquote> <h2 id="mastering-tdd"> <a href="#mastering-tdd" class="anchor-heading" aria-labelledby="mastering-tdd"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Mastering TDD </h2> <h3 id="what-dont-you-have-to-test"> <a href="#what-dont-you-have-to-test" class="anchor-heading" aria-labelledby="what-dont-you-have-to-test"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> What don’t you have to test? </h3> <blockquote> <p>Write tests until fear is transformed into boredom</p> </blockquote> <p>Unless you have a reason to distrust it, don’t test code from others.</p> <h3 id="how-do-you-know-if-you-have-good-tests"> <a href="#how-do-you-know-if-you-have-good-tests" class="anchor-heading" aria-labelledby="how-do-you-know-if-you-have-good-tests"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> How do you know if you have good tests? </h3> <p>The tests are a canary in a coal mine revealing by their distress the presence of evil vapors. Signals that your design is in trouble.</p> <ul> <li><strong>Long setup code</strong>. If you have to spend a hundred lines creating the objects for one simple assertion, something is wrong. Your objects are too big and need to be split.</li> <li><strong>Setup duplication</strong>. If you can’t easily find a common place for common setup code, there are too many objects too tightly intertwingled.</li> <li><strong>Long running tests</strong>. TDD tests that run a long time won’t be run often, and often haven’t been run for a while, and probably don’t work. Worse than this, this might suggest that testing the bits and pieces of the application is hard, and this is a design problem.</li> <li><strong>Fragile tests</strong>. Tests that break unexpectedly suggest that one part of the application is surprisingly affecting another part.</li> </ul> <h3 id="how-does-tdd-lead-to-frameworks"> <a href="#how-does-tdd-lead-to-frameworks" class="anchor-heading" aria-labelledby="how-does-tdd-lead-to-frameworks"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> How does TDD lead to frameworks </h3> <p>Paradox: By not considering the future of your code you make your code much more likely to be able to adapt in the future.</p> <h3 id="when-should-you-delete-tests"> <a href="#when-should-you-delete-tests" class="anchor-heading" aria-labelledby="when-should-you-delete-tests"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> When should you delete tests? </h3> <p>Never delete a test if it reduces your confidence in the behavior of the system. If you have two tests that exercise the same path through the code, but they speak to different scenarios for readers, leave them alone.</p> <p>If you have two tests that are redundant with respect to confidence and communication, delete the least useful of the two.</p> <h3 id="how-does-the-programming-language-and-environment-influence-tdd"> <a href="#how-does-the-programming-language-and-environment-influence-tdd" class="anchor-heading" aria-labelledby="how-does-the-programming-language-and-environment-influence-tdd"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> How does the programming language and environment influence TDD? </h3> <p>In programming languages and environments where TDD cycles (test/compile/run/refactor) are harder to come by, you will be likely to be tempted to take larger steps.</p> <h3 id="can-you-drive-development-with-application-level-tests-atdd"> <a href="#can-you-drive-development-with-application-level-tests-atdd" class="anchor-heading" aria-labelledby="can-you-drive-development-with-application-level-tests-atdd"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Can you drive development with application-level tests (ATDD)? </h3> <p>The problem with driving development with small scale test (“unit tests”) is that you run the risk of implementing what you think a user wants.</p> <p>If we wrote the tests at the level of the application, then the users could write tests themselves for what exactly they wanted the system to do next. There is a technical problem, how you can write and run a test for a feature that doesn’t exist yet? There is a social problem with ATDD, writing tests is a new responsibility for users and organizations resist this kind of shift of responsibility.</p> <p>TDD is a technique that is entirely under your control. Mixing up the rhythm of red/green/refactor, the technical issues of application fixturing, and the organizational change issues surrounding user-written tests is unlikely to be successful. Another aspect of ATDD is the length of the cycle between test and feedback.</p> <h3 id="how-do-you-switch-to-tdd-mid-stream"> <a href="#how-do-you-switch-to-tdd-mid-stream" class="anchor-heading" aria-labelledby="how-do-you-switch-to-tdd-mid-stream"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> How do you switch to TDD mid-stream? </h3> <p>The biggest problem is that code that isn’t written with tests in mind typically isn’t very testable. “Fix it”, you say. Yes, well, but refactoring (without automated toos) is likely to result in errors, errors that you won’t catch because you don’t have the tests.</p> <p>What you don’t do is go write tests for the whole thing and refactor the whole thing, that would take months.</p> <p>Parts of the system that don’t demand change at the moment we will leave them alone.</p> <p>We have to break the deadlock between tests and refactoring. We can get feedback working very carefully and with a partner. System level tests give us some confidence.</p> <h3 id="who-is-tdd-intended-for"> <a href="#who-is-tdd-intended-for" class="anchor-heading" aria-labelledby="who-is-tdd-intended-for"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Who is TDD intended for? </h3> <p>If you are happy slamming some code together that more or less works and never looking a the same result again, TDD is not for you. TDD rests on a charmingly naive geekoid assumption that if you write better code, you’ll be more successful</p> <p>What’s naive is assuming that code is all there is to success. Good engineering is maybe 20% of a project’s success. Bad engineering will certainly sink projects, but modest engineering can enable project success as long as the other 80% liens up for it.</p> <p>Those whose souls are healed by the balm of elegance can find in TDD a way to do well by doing good. TDD is also good for geeks who form emotional attachments to code.</p> <blockquote> <p>My goal is to feel better about a project after a year than I did in the starry-eyed beginning, and TDD helps me achieve this.</p> </blockquote> <h3 id="why-does-tdd-work"> <a href="#why-does-tdd-work" class="anchor-heading" aria-labelledby="why-does-tdd-work"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Why does TDD work? </h3> <p>Let’s assume for the moment that TDD helps teams productively build loosely coupled, highly cohesive systems with low level defect rates and low cost of maintenance profiles. The sooner you find and fix a defect, the cheaper it is.</p> <p>Programmers really do relax, teams really do develop trust, and customers really do learn to look forward to new releases.</p> <p>It’s effect is the way it shortens the feedback loop on design decisions.</p> <blockquote> <p>Adopt programming practices that “attract” correct code as a limit function, not as an absolute value.</p> </blockquote> <h3 id="whats-with-the-name"> <a href="#whats-with-the-name" class="anchor-heading" aria-labelledby="whats-with-the-name"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> What’s with the name? </h3> <p>One kind of the ironies of TDD is that it isn’t a testing technique, it’s an analysis technique, a design technique, really a technique for all the activities of development.</p> <h3 id="darachs-challenge"> <a href="#darachs-challenge" class="anchor-heading" aria-labelledby="darachs-challenge"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Darach’s challenge </h3> <ul> <li>You can’t test GUIs automaticaly</li> <li>You can’t unit test distributed objects automaticaly</li> <li>You can’t test-first develop your database schema</li> <li>There is no need to test third party code</li> <li>You can’t test first develop a language compiler / interpreter.</li> </ul> </div> </div> <div class="search-overlay"></div> </div> </body> </html>
