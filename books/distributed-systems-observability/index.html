<!DOCTYPE html> <html lang="en-US"> <head> <meta charset="UTF-8"> <meta http-equiv="X-UA-Compatible" content="IE=Edge"> <link rel="shortcut icon" href="/learning-notes/favicon.ico" type="image/x-icon"> <link rel="stylesheet" href="/learning-notes/assets/css/just-the-docs-default.css"> <script type="text/javascript" src="/learning-notes/assets/js/vendor/lunr.min.js"></script> <script type="text/javascript" src="/learning-notes/assets/js/just-the-docs.js"></script> <meta name="viewport" content="width=device-width, initial-scale=1"> <!-- Begin Jekyll SEO tag v2.7.1 --> <title>Distributed Systems Observability | Notes</title> <meta name="generator" content="Jekyll v3.9.0" /> <meta property="og:title" content="Distributed Systems Observability" /> <meta property="og:locale" content="en_US" /> <meta name="description" content="Keyvan Akbary learning notes" /> <meta property="og:description" content="Keyvan Akbary learning notes" /> <meta property="og:site_name" content="Notes" /> <meta name="twitter:card" content="summary" /> <meta property="twitter:title" content="Distributed Systems Observability" /> <script type="application/ld+json"> {"headline":"Distributed Systems Observability","description":"Keyvan Akbary learning notes","@type":"WebPage","url":"/learning-notes/books/distributed-systems-observability/","@context":"https://schema.org"}</script> <!-- End Jekyll SEO tag --> </head> <body> <svg xmlns="http://www.w3.org/2000/svg" style="display: none;"> <symbol id="svg-link" viewBox="0 0 24 24"> <title>Link</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"> <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-search" viewBox="0 0 24 24"> <title>Search</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"> <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </symbol> <symbol id="svg-menu" viewBox="0 0 24 24"> <title>Menu</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"> <line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewBox="0 0 24 24"> <title>Expand</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"> <polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <symbol id="svg-doc" viewBox="0 0 24 24"> <title>Document</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"> <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> </svg> <div class="side-bar"> <div class="site-header"> <a href="/learning-notes/" class="site-title lh-tight"> Notes </a> <a href="#" id="menu-button" class="site-button"> <svg viewBox="0 0 24 24" class="icon"><use xlink:href="#svg-menu"></use></svg> </a> </div> <nav role="navigation" aria-label="Main" id="site-nav" class="site-nav"> <ul class="nav-list"><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/learning-notes/articles/" class="nav-list-link">Articles</a><ul class="nav-list "></ul></li><li class="nav-list-item active"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/learning-notes/books/" class="nav-list-link">Books</a><ul class="nav-list "></ul></li><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/learning-notes/talks/" class="nav-list-link">Talks</a><ul class="nav-list "></ul></li><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/learning-notes/papers/" class="nav-list-link">Papers</a><ul class="nav-list "></ul></li></ul> </nav> <footer class="site-footer"> This site uses <a href="https://github.com/pmarsceill/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll. </footer> </div> <div class="main" id="top"> <div id="main-header" class="main-header"> <div class="search"> <div class="search-input-wrap"> <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search Notes" aria-label="Search Notes" autocomplete="off"> <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label> </div> <div id="search-results" class="search-results"></div> </div> <nav aria-label="Auxiliary" class="aux-nav"> <ul class="aux-nav-list"> <li class="aux-nav-list-item"> <a href="//github.com/keyvanakbary/learning-notes" class="site-button" > Learning Notes on GitHub </a> </li> </ul> </nav> </div> <div id="main-content-wrap" class="main-content-wrap"> <nav aria-label="Breadcrumb" class="breadcrumb-nav"> <ol class="breadcrumb-nav-list"> <li class="breadcrumb-nav-list-item"><a href="/learning-notes/books/">Books</a></li> <li class="breadcrumb-nav-list-item"><span>Distributed Systems Observability</span></li> </ol> </nav> <div id="main-content" class="main-content" role="main"> <h1 id="distributed-systems-observability"> <a href="#distributed-systems-observability" class="anchor-heading" aria-labelledby="distributed-systems-observability"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <a href="https://www.goodreads.com/book/show/40182805-distributed-systems-observability">Distributed Systems Observability</a> </h1> <ul> <li><a href="#the-need-of-observability">The need of observability</a></li> <li><a href="#monitoring-and-observability">Monitoring and observability</a></li> <li><a href="#coding-and-testing-for-observability">Coding and testing for observability</a> <ul> <li><a href="#testing-for-failure">Testing for failure</a></li> </ul> </li> <li><a href="#the-three-pillars-of-observability">The three pillars of observability</a> <ul> <li><a href="#event-logs">Event logs</a></li> <li><a href="#metrics">Metrics</a></li> <li><a href="#tracing">Tracing</a></li> </ul> </li> </ul> <p>Most failures not addressed by application layers will arise from the complex interactions between various applications.</p> <p>Observability isn’t purely an operational concern.</p> <h2 id="the-need-of-observability"> <a href="#the-need-of-observability" class="anchor-heading" aria-labelledby="the-need-of-observability"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> The need of observability </h2> <p><strong>Observability is not just about logs, metrics and traces it’s about bringing better visibility into systems.</strong></p> <p>Observability is a property of the system. It does acknowledge the following</p> <ul> <li>No complex system is ever fully healthy.</li> <li>Distributed systems are unpredictable.</li> <li>It’s impossible to predict the state of different parts of the system.</li> <li>Failure needs to be embraced.</li> <li>Easy debugging is fundamental.</li> </ul> <p>Observability is a feature that needs to be enshrined into a system.</p> <ul> <li>Lends itself well to being tested in a realistic manner (a degree of testing in production).</li> <li>Failure modes can be surfaced during the time of testing.</li> <li>Deployments can happen incrementally so the rollback can be triggered if a key of metrics deviate from the baseline.</li> <li>Report enough data points, so the system can be understood.</li> </ul> <h2 id="monitoring-and-observability"> <a href="#monitoring-and-observability" class="anchor-heading" aria-labelledby="monitoring-and-observability"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Monitoring and observability </h2> <p><strong>Observability is a superset of monitoring.</strong> It provides highly granular insights into the implicit failure modes of the system. An observable system provides contexts about its inner workings.</p> <p><strong>Monitoring reports the overall health of systems and derives alerts</strong></p> <blockquote> <h3 id="blackbox-and-whitebox-monitoring"> <a href="#blackbox-and-whitebox-monitoring" class="anchor-heading" aria-labelledby="blackbox-and-whitebox-monitoring"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Blackbox and whitebox monitoring </h3> <p><em>Blackbox monitoring</em> refers to observing a system from the outside. Useful for identify the <em>symptoms</em> of a problem like “error rate is up”. <em>Whitebox monitoring</em> refers to techniques of reporting data form inside a system.</p> </blockquote> <p>Monitoring data should always provide a bird’s-eye view of the overall health of a distributed system by recording and exposing high-level metrics over time across all components of the system.</p> <p><strong>All alerts need to be <em>actionable</em>.</strong></p> <p>A good set of metrics are the USE metrics and the RED metrics.</p> <ul> <li>USE methodology is for analysing system performance like utilisation, saturation, errors of resources, free memory, CPU or device errors.</li> <li>RED methodology is about application level metrics like request rate, error rate, and duration of the requests.</li> </ul> <p>Debugging is often an iterative process and involves</p> <ul> <li>Start with a high-level metric</li> <li>Drill down observations</li> <li>Make the right deductions</li> <li>Testing the theory</li> </ul> <p>Observability doesn’t obviate the need for careful thought. The process of knowing what information to examine (observations), requires a good understanding of the system and domain, as well as a good sense of intuition.</p> <h2 id="coding-and-testing-for-observability"> <a href="#coding-and-testing-for-observability" class="anchor-heading" aria-labelledby="coding-and-testing-for-observability"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Coding and testing for observability </h2> <p>The idea of experimenting with live traffic is either seen as the preserve of operations engineers or is something that’s met with alarm. Some amount of regression testing to post-production monitoring requires coding and testing for failure.</p> <p>Acknowledging that systems will fail, being able to debug such failures is of paramount importance, and embedding debuggability into the system from the ground up.</p> <p>Understanding service dependencies and abstractions better, allows you to improve reliability massively just by changing a single line of configuration.</p> <h3 id="testing-for-failure"> <a href="#testing-for-failure" class="anchor-heading" aria-labelledby="testing-for-failure"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Testing for failure </h3> <p>Unit tests only ever test the behaviour of a system against specified set of inputs.</p> <p>End-to-end testing might allow for some degree of holistic testing of the system, but complex systems fail in complex ways.</p> <p>The tooling aimed to understand the behaviour of our services in production does not obviate the need for pre-production testing.</p> <p><strong>Certain types of failures can only be surfaced in the production environment.</strong></p> <div class="table-wrapper"><table> <thead> <tr> <th>Pre-production</th> <th>Deploy</th> <th>Release</th> <th>Post-release</th> </tr> </thead> <tbody> <tr> <td>- Unit tests</td> <td>- Integration tests</td> <td>- Canarying</td> <td>- Teeing</td> </tr> <tr> <td>- Functional tests</td> <td>- Tap compare</td> <td>- Monitoring</td> <td>- Profiling</td> </tr> <tr> <td>- Component tests</td> <td>- Load tests</td> <td>- Traffic shaping</td> <td>- Logs/events</td> </tr> <tr> <td>- Stress tests</td> <td>- Shadowing</td> <td>- Feature flagging</td> <td>- Chaos testing</td> </tr> <tr> <td>- Static analysis</td> <td>- Soak tests</td> <td> </td> <td>- Monitoring</td> </tr> <tr> <td>- Property based tests</td> <td> </td> <td> </td> <td>- A/B tests</td> </tr> <tr> <td>- Coverage tests</td> <td> </td> <td> </td> <td>- Tracing</td> </tr> <tr> <td>- Benchmark tests</td> <td> </td> <td> </td> <td>- Dynamic exploration</td> </tr> <tr> <td>- Regression tests</td> <td> </td> <td> </td> <td>- Real user monitoring</td> </tr> <tr> <td>- Contract tests</td> <td> </td> <td> </td> <td>- Auditing</td> </tr> <tr> <td>- Lint tests</td> <td> </td> <td> </td> <td>- On-call experience</td> </tr> <tr> <td>- Acceptance tests</td> <td> </td> <td> </td> <td> </td> </tr> <tr> <td>- Mutation tests</td> <td> </td> <td> </td> <td> </td> </tr> <tr> <td>- Smoke tests</td> <td> </td> <td> </td> <td> </td> </tr> <tr> <td>- UI/UX tests</td> <td> </td> <td> </td> <td> </td> </tr> <tr> <td>- Usability tests</td> <td> </td> <td> </td> <td> </td> </tr> <tr> <td>- Penetration tests</td> <td> </td> <td> </td> <td> </td> </tr> <tr> <td>- Threat modelling</td> <td> </td> <td> </td> <td> </td> </tr> </tbody> </table></div> <p>Testing in production (deploy, release and post-release phases) is impossible to do without measuring how the system under test is performing in production.</p> <h2 id="the-three-pillars-of-observability"> <a href="#the-three-pillars-of-observability" class="anchor-heading" aria-labelledby="the-three-pillars-of-observability"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> The three pillars of observability </h2> <h3 id="event-logs"> <a href="#event-logs" class="anchor-heading" aria-labelledby="event-logs"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Event logs </h3> <p>An <em>event log</em> is an immutable, timestamped record of discrete events that happened over time. Usually a pair of a timestamp and a payload of some context. There are three forms: plain text, structured (peg: JSON) and binary (peg: Protobuf format in MySQL binlogs).</p> <p>Event logs are especially helpful for uncovering emergent and unpredictable behaviours exhibited by components of a distributed system.</p> <p>Traces and metrics are an abstraction built on top of logs.</p> <p><strong>Pros:</strong></p> <ul> <li>Easiest to generate</li> <li>Easy to instrument</li> </ul> <p><strong>Cons:</strong></p> <ul> <li>Suboptimal performance due to the overhead of logging.</li> <li>Messages can be lost unless one uses a protocol like RELP to guarantee delivery of messages.</li> </ul> <p>Logging excessively has the capability to adversely affect application performance as a whole. A solution to this is to do <em>Sampling</em>, picking a small subset of the total population of event logs.</p> <p>Raw logs are almost always normalised, filtered, and processed by a tool like Logstash, fluentd, Scribe or Heka before they’re persisted in a data store like Elasticsearch or BigQuery. Logs might require further buffering in a broker like Kafka before they can be processed by Logstash.</p> <p>Logs can also be the source for all analytics data, which has a tremendous utility from a business intelligence perspective. Complex queries can be made thanks to storing events. Events are structured key-value paris.</p> <p>Most analytics pipelines use Kafka as an event bus. Sending enriched event data to Kafka allows one to search in real time over streams with KSQL, an SQL engine for Kafka. This data can be expired from the Kafka log regularly. There are alternatives like Humio, Honeycomb and Facebook’s Scuba.</p> <h3 id="metrics"> <a href="#metrics" class="anchor-heading" aria-labelledby="metrics"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Metrics </h3> <p><em>Metrics</em> are a numeric representation of data measured over intervals of time.</p> <p>Since they are numbers, metrics enable longer retention of data as well as easier querying. They are perfectly suited to building dashboards that reflect historical trends stored in time-series databases.</p> <p>Modern monitoring systems like Prometheus and newer versions of Graphite represent every time series using a metric name as well as additional key-value pairs called <em>labels</em>.</p> <p><strong>Pros:</strong></p> <ul> <li>Metrics transfer and storage has a constant overhead. The cost doesn’t increase in lockstep with user traffic. Storage increases with more permutations of label values tho.</li> <li>They are more malleable to mathematical, probabilistic, and statistical transformations such as sampling, aggregation, summarisation, and correlation. They are better suited to report the overall health of a system.</li> <li>Metrics are also better suited to trigger alerts.</li> </ul> <p><strong>Cons:</strong></p> <ul> <li>They are <em>system</em> scoped, making it hard to understand anything else other than what’s happening inside a particular system.</li> <li>A single line doesn’t give you much information about what happened to a request across all components of a system. Distributed tracing is a technique that addresses the problem of brining visibility into the lifetime of a request across several systems.</li> </ul> <h3 id="tracing"> <a href="#tracing" class="anchor-heading" aria-labelledby="tracing"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Tracing </h3> <p>A <em>trace</em> is a representation of a series of casually related distributed events that encode end-to-end request flow through a distributed system.</p> <p>Traces identify specific points in an application, proxy, framework, library, runtime, middleware and anything else in the path of the request that represents:</p> <ul> <li>Forks in execution path</li> <li>A hop or a fan out across network or process boundaries.</li> </ul> <p>A trace is a directed acyclic graph of <em>spans</em>, where the edges between spans are called <em>references</em>.</p> <p>When a request begins, it’s assigned a globally unique ID, which is then propagated through the request path, so that each point of instrumentation is able to insert or enrich metadata before passing the ID around to the next hop. Each hop along the flow is represented by a span. Each record emitted on each service are usually asynchronously logged to disk before being submitted out of band to a collector, which then can reconstruct the flow of execution.</p> <p>Understanding request lifecycles makes it possible to debug requests spanning multiple services to pinpoint the source of increased latency or resource utilisation.</p> <p>Zipkin and Jaeger are the two most popular OpenTracing-compliant open source distributed tracing solutions.</p> <p><strong>Cons:</strong></p> <ul> <li>Traces are the hardest to retrofit into an existing infrastructure. Every component in the path of a request needs to be modified to propagate tracing information.</li> <li>It’s not sufficient for developers to instrument just their own code alone.</li> <li>Challenging at places with polyglot architectures.</li> </ul> <blockquote> <h4 id="service-mesh-a-new-hope"> <a href="#service-mesh-a-new-hope" class="anchor-heading" aria-labelledby="service-mesh-a-new-hope"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Service mesh, a new hope </h4> <p>Service meshes make integrating tracing functionality almost effortless as they implement tracing and stats collections at the proxy level. Applications will still need to forward headers to the next hop in the mesh, but no additional instrumentation is necessary.</p> </blockquote> </div> </div> <div class="search-overlay"></div> </div> </body> </html>
